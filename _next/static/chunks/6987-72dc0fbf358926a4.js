"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6987],{56987:(e,s,t)=>{var n=Object.create?function(e,s,t,n){void 0===n&&(n=t);var l=Object.getOwnPropertyDescriptor(s,t);(!l||("get"in l?!s.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return s[t]}}),Object.defineProperty(e,n,l)}:function(e,s,t,n){void 0===n&&(n=t),e[n]=s[t]},l=Object.create?function(e,s){Object.defineProperty(e,"default",{enumerable:!0,value:s})}:function(e,s){e.default=s},a=function(){var e=function(s){return(e=Object.getOwnPropertyNames||function(e){var s=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[s.length]=t);return s})(s)};return function(s){if(s&&s.__esModule)return s;var t={};if(null!=s)for(var a=e(s),r=0;r<a.length;r++)"default"!==a[r]&&n(t,s,a[r]);return l(t,s),t}}(),r=function(e,s){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>s.indexOf(n)&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var l=0,n=Object.getOwnPropertySymbols(e);l<n.length;l++)0>s.indexOf(n[l])&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(t[n[l]]=e[n[l]]);return t},i=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.getObjectRelationsByTypename=function(e,s){let t=O(e,s),n={};return t.filter(e=>e.isRelation&&!e.isList&&e.targetTypename).forEach(e=>{n[e.name]=e.targetTypename}),n},s.getArrayRelationsByTypename=function(e,s){let t=O(e,s),n={};return t.filter(e=>e.isRelation&&e.isList&&e.targetTypename).forEach(e=>{n[e.name]=e.targetTypename}),n},s.getIdFieldsByTypename=function(e,s){return O(e,s).filter(e=>e.isScalar&&"uuid"===e.typeName).map(e=>e.name)},s.default=function(e){let{serverSession:s,sidebarData:t,schema:n=N.default}=e,{data:l,status:a}=(0,v.useSession)(),[r,i]=(0,o.useState)({table:"users",where:{},returning:[],role:"anonymous",limit:10,offset:void 0,order_by:void 0}),d=o.default.useRef(!1);return(0,o.useEffect)(()=>{var e,s,t,c;if("loading"!==a&&!d.current){let a=(null==l?void 0:l.user)?"user":"anonymous",o=r.table||"users",u=n?C(n,o):[],m=null==(c=null==(t=null==(s=null==(e=null==n?void 0:n.hasyx)?void 0:e.permissions)?void 0:s[o])?void 0:t.select)?void 0:c[a],x=[];Array.isArray(m)&&(x=u.filter(e=>!e.isRelation&&!e.name.startsWith("_hasyx_")&&m.includes(e.name)).map(e=>e.name)),0===x.length&&u.some(e=>"id"===e.name&&!e.isRelation)&&x.push("id"),i(e=>Object.assign(Object.assign({},e),{role:a,returning:x})),d.current=!0}},[a,l,n,r.table]),(0,c.jsx)(u.SidebarLayout,{sidebarData:t,breadcrumb:[{title:"Hasyx",link:"/"},{title:"Constructor",link:"/hasyx/constructor"}],children:(0,c.jsx)(W,{value:r,onChange:i,defaultTable:"users",schema:N.default})})},s.HasyxConstructor=V,s.HasyxConstructorResults=z,s.HasyxConstructorColumns=W,s.HasyxConstructorTabs=E,s.HasyxConstructorButton=function(e){var{value:s,onChange:t,defaultTable:n="users",icon:l,size:a="default",schema:i=N.default,children:d=null}=e,u=r(e,["value","onChange","defaultTable","icon","size","schema","children"]);let[x,b]=(0,o.useState)(!1);return(0,c.jsxs)(c.Fragment,{children:[d?(0,c.jsx)(h.Button,Object.assign({variant:"outline",size:a,onClick:()=>b(!0)},u,{className:(0,y.cn)("square",u.className),children:d})):(0,c.jsx)(h.Button,Object.assign({variant:"outline",size:a,onClick:()=>b(!0)},u,{className:(0,y.cn)("square",u.className),children:l||(0,c.jsx)(p.Search,{className:"h-4 w-4"})})),x&&(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,c.jsxs)(m.Card,{className:"w-full max-w-6xl h-[80vh] max-h-[800px] relative",children:[(0,c.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,c.jsx)(h.Button,{variant:"ghost",size:"sm",className:"square",onClick:()=>b(!1),children:(0,c.jsx)(p.X,{className:"h-4 w-4"})})}),(0,c.jsx)(m.CardContent,{className:"p-4 h-full",children:(0,c.jsx)(E,{value:s,onChange:t,defaultTable:n,schema:i})})]})})]})};let c=t(95155),o=a(t(12115)),d=(i(t(40054)),t(192)),u=t(2693),m=t(53959),x=t(25913),h=t(51825),b=t(1035),g=t(34545),f=t(51364),j=t(76862),p=t(47937),v=t(12108),N=i(t(11600)),y=t(27010);function O(e,s){var t,n,l,a,r,i,c,o,d;if(!s)return[];let u=null==(n=null==(t=null==e?void 0:e.hasyx)?void 0:t.tableMappings)?void 0:n[s],m=(null==u?void 0:u.type)||s,x=null==(r=null==(a=null==(l=null==e?void 0:e.data)?void 0:l.__schema)?void 0:a.types)?void 0:r.find(e=>e.name===m);return x&&(null==x?void 0:x.fields)||(x=null==(o=null==(c=null==(i=null==e?void 0:e.data)?void 0:i.__schema)?void 0:c.types)?void 0:o.find(e=>e.name===s)),(null==(d=x)?void 0:d.fields)?d.fields.map(s=>{var t;let n,l=s.type,a=!1;"NON_NULL"===l.kind&&(l=l.ofType),"LIST"===l.kind&&(a=!0,"NON_NULL"===(l=l.ofType).kind&&(l=l.ofType));let r="OBJECT"===l.kind,i="SCALAR"===l.kind,c=l.name;if(r){let s=null==(t=null==e?void 0:e.hasyx)?void 0:t.tableMappings;n=s&&Object.keys(s).find(e=>s[e].type===l.name)||l.name}return{name:s.name,isRelation:r,isList:a,isScalar:i,typeName:c,targetTypename:n}}):[]}function C(e,s){var t,n,l,a;let r=[s,s.toLowerCase(),s.charAt(0).toUpperCase()+s.slice(1),s.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join("_")],i=null;for(let s of r)if(i=null==(l=null==(n=null==(t=null==e?void 0:e.data)?void 0:t.__schema)?void 0:n.types)?void 0:l.find(e=>e.name===s))break;if(!i||!(null==i?void 0:i.fields)){let e=[{name:"id",type:"String",isRelation:!1},{name:"created_at",type:"DateTime",isRelation:!1},{name:"updated_at",type:"DateTime",isRelation:!1}];return"users"===s?[...e,{name:"name",type:"String",isRelation:!1},{name:"email",type:"String",isRelation:!1},{name:"accounts",type:"Account",isRelation:!0,targetTable:"accounts",isList:!0},{name:"notifications",type:"Notification",isRelation:!0,targetTable:"notifications",isList:!0}]:"accounts"===s?[...e,{name:"provider",type:"String",isRelation:!1},{name:"provider_id",type:"String",isRelation:!1},{name:"user_id",type:"String",isRelation:!1},{name:"user",type:"User",isRelation:!0,targetTable:"users",isList:!1}]:"notifications"===s?[...e,{name:"title",type:"String",isRelation:!1},{name:"message",type:"String",isRelation:!1},{name:"user_id",type:"String",isRelation:!1},{name:"user",type:"User",isRelation:!0,targetTable:"users",isList:!1}]:e}return null==(a=null==i?void 0:i.fields)?void 0:a.map(e=>{var s;let t=e.type,n=!1;"NON_NULL"===t.kind&&(t=t.ofType),"LIST"===t.kind&&(n=!0,"NON_NULL"===(t=t.ofType).kind&&(t=t.ofType));let l="OBJECT"===t.kind,a="String";return(null==t?void 0:t.name)?a=t.name:(null==(s=null==t?void 0:t.ofType)?void 0:s.name)&&(a=t.ofType.name),"uuid"===a&&(a="UUID"),"bigint"===a&&(a="Int"),"timestamptz"===a&&(a="DateTime"),"jsonb"===a&&(a="JSONB"),"boolean"===a&&(a="Boolean"),{name:e.name,type:a,isRelation:l,isList:n,targetTable:l?t.name:void 0}})}function w(e){let s=e.filter(e=>!e.isRelation),t=e.filter(e=>e.isRelation);return s.sort((e,s)=>e.name.localeCompare(s.name)),t.sort((e,s)=>e.name.localeCompare(s.name)),[...s,...t]}function S(e){for(let s of["id","uuid","pk","_id"]){let t=e.find(e=>e.name===s&&!e.isRelation);if(t)return t.name}return null}function _(e,s){if(!s||!e[s])return{usePk:!1,remainingWhere:e};let t=Object.keys(e);if(1===t.length&&t[0]===s){let t=e[s];if(t&&"object"==typeof t&&void 0!==t._eq)return{usePk:!0,pkValue:t._eq,remainingWhere:{}}}return{usePk:!1,remainingWhere:e}}function T(e){let{value:s,onChange:t,operator:n,fieldType:l}=e;return"_is_null"===n?(0,c.jsxs)(x.Select,{value:(null==s?void 0:s.toString())||"false",onValueChange:e=>t("true"===e),children:[(0,c.jsx)(x.SelectTrigger,{className:"h-full border-0 rounded-none text-xs bg-transparent",children:(0,c.jsx)(x.SelectValue,{})}),(0,c.jsxs)(x.SelectContent,{children:[(0,c.jsx)(x.SelectItem,{value:"true",children:"true"}),(0,c.jsx)(x.SelectItem,{value:"false",children:"false"})]})]}):"_in"===n||"_nin"===n?(0,c.jsx)(b.Input,{type:"text",value:Array.isArray(s)?s.join(", "):s||"",onChange:e=>{t(e.target.value.split(",").map(e=>e.trim()).filter(e=>e))},placeholder:"value1, value2, value3",className:"h-full border-0 rounded-none text-xs bg-transparent focus:bg-transparent px-1"}):"Boolean"===l?(0,c.jsxs)(x.Select,{value:(null==s?void 0:s.toString())||"true",onValueChange:e=>t("true"===e),children:[(0,c.jsx)(x.SelectTrigger,{className:"h-full border-0 rounded-none text-xs bg-transparent",children:(0,c.jsx)(x.SelectValue,{})}),(0,c.jsxs)(x.SelectContent,{children:[(0,c.jsx)(x.SelectItem,{value:"true",children:"true"}),(0,c.jsx)(x.SelectItem,{value:"false",children:"false"})]})]}):"Int"===l||"Float"===l?(0,c.jsx)(b.Input,{type:"number",value:s||"",onChange:e=>t(Number(e.target.value)),placeholder:"0",className:"h-full border-0 rounded-none text-xs bg-transparent focus:bg-transparent px-1"}):(0,c.jsx)(b.Input,{type:"text",value:s||"",onChange:e=>t(e.target.value),placeholder:"value",className:"h-full border-0 rounded-none text-xs bg-transparent focus:bg-transparent px-1"})}function k(e){let{fieldName:s,fieldType:t,value:n,onUpdate:l,onRemove:a}=e,r=function(e){let s=[{name:"_eq",label:"equals"},{name:"_ne",label:"not equals"},{name:"_is_null",label:"is null"}];return"String"===e?[...s,{name:"_like",label:"like"},{name:"_ilike",label:"ilike"},{name:"_in",label:"in"}]:"Int"===e||"Float"===e||"DateTime"===e?[...s,{name:"_gt",label:">"},{name:"_gte",label:">="},{name:"_lt",label:"<"},{name:"_lte",label:"<="},{name:"_in",label:"in"}]:"Boolean"===e?[{name:"_eq",label:"equals"},{name:"_ne",label:"not equals"}]:s}(t),i=Object.keys(n||{})[0]||"_eq",o=null==n?void 0:n[i];return(0,c.jsxs)("div",{className:"w-full flex items-center border rounded h-6 bg-background",children:[(0,c.jsx)("div",{className:"px-2 py-1 text-xs font-medium bg-muted/50 flex-shrink-0",children:s}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsxs)(x.Select,{value:i,onValueChange:e=>l(e,o),children:[(0,c.jsx)(x.SelectTrigger,{className:"h-6 border-0 rounded-none px-2 text-xs bg-transparent hover:bg-muted/50 flex-shrink-0 min-w-12 max-h-full",children:(0,c.jsx)(x.SelectValue,{})}),(0,c.jsx)(x.SelectContent,{children:r.map(e=>(0,c.jsx)(x.SelectItem,{value:e.name,className:"text-xs",children:e.label},e.name))})]}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsx)("div",{className:"flex-1 px-1",children:(0,c.jsx)(T,{value:o,onChange:e=>l(i,e),operator:i,fieldType:t})}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:a,className:"h-full w-6 px-0 border-0 rounded-none hover:bg-destructive/10 hover:text-destructive flex-shrink-0",children:(0,c.jsx)(p.X,{className:"h-3 w-3"})})]})}function R(e){let{fields:s,returning:t,onReturningChange:n,schema:l,level:a=0}=e,r=(e,s,a,r)=>{s&&a?n([...t,{[e]:Object.assign({returning:C(l,a).some(e=>"id"===e.name&&!e.isRelation)?["id"]:[]},r&&{limit:10})}]):n([...t,e])},i=e=>{let s=[...t];s.splice(e,1),n(s)},o=(e,s,l)=>{let a=[...t];a[e][s].returning=l,n(a)},d=(e,s,l)=>{let a=[...t];a[e][s].where=l,n(a)},u=(e,s,l)=>{let a=[...t];a[e][s].limit=l,n(a)},m=(e,s,l)=>{let a=[...t];a[e][s].offset=l,n(a)},b=(e,s,l)=>{let a=[...t];a[e][s].order_by=l,n(a)},f=w(s.filter(e=>!t.some(s=>"string"==typeof s?s===e.name:Object.keys(s)[0]===e.name)));return(0,c.jsxs)("div",{className:a>0?"ml-1 border-l pl-1":"",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,c.jsx)(g.Label,{className:"text-xs font-medium",children:"Returning"}),(0,c.jsxs)("div",{className:"flex items-center",children:[t.length>0&&(0,c.jsx)(h.Button,{variant:"ghost",onClick:()=>n([]),className:"h-6 w-6 p-0 rounded-none",children:(0,c.jsx)(p.X,{className:"h-2.5 w-2.5"})}),f.length>0&&(0,c.jsxs)(x.Select,{onValueChange:e=>{let t=s.find(s=>s.name===e);t&&r(t.name,t.isRelation,t.targetTable,t.isList)},children:[(0,c.jsx)(x.SelectTrigger,{className:"square border-0 rounded-none hover:bg-destructive/10 hover:text-destructive flex-shrink-0 [&>svg:nth-child(2)]:hidden",children:(0,c.jsx)(p.Plus,{className:"h-2.5 w-2.5 flex-shrink-0"})}),(0,c.jsx)(x.SelectContent,{children:f.map(e=>(0,c.jsxs)(x.SelectItem,{value:e.name,className:"text-xs",children:[e.name," ",e.isRelation&&(0,c.jsxs)("span",{className:"text-muted-foreground",children:["(",e.targetTable,")"]})]},e.name))})]})]})]}),(0,c.jsx)("div",{className:"space-y-1",children:t.map((e,t)=>{if("string"==typeof e)return(0,c.jsxs)("div",{className:"w-full flex items-center border rounded h-6 bg-background",children:[(0,c.jsx)("div",{className:"px-2 py-1 text-xs font-medium bg-muted/50 flex-1",children:e}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>i(t),className:"h-full w-6 px-0 border-0 rounded-none hover:bg-destructive/10 hover:text-destructive flex-shrink-0",children:(0,c.jsx)(p.X,{className:"h-2.5 w-2.5"})})]},t);{let n=Object.keys(e)[0],r=e[n],x=s.find(e=>e.name===n),g=(null==x?void 0:x.targetTable)?C(l,x.targetTable):[];return(0,c.jsxs)("div",{className:"border rounded p-1 my-1",children:[(0,c.jsxs)("div",{className:"w-full flex items-center border rounded h-6 bg-background mb-1",children:[(0,c.jsx)("div",{className:"px-2 py-1 text-xs font-medium bg-primary/10 flex-1",children:n}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>i(t),className:"h-full w-6 px-0 border-0 rounded-none hover:bg-destructive/10 hover:text-destructive flex-shrink-0",children:(0,c.jsx)(p.X,{className:"h-2.5 w-2.5"})})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)(L,{fields:g,where:r.where||{},onWhereChange:e=>d(t,n,e),level:a+1}),(null==x?void 0:x.isList)&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(I,{limit:r.limit,offset:r.offset,onLimitChange:e=>u(t,n,e),onOffsetChange:e=>m(t,n,e)}),(0,c.jsx)(B,{fields:g,orderBy:r.order_by,onChange:e=>b(t,n,e)})]}),(0,c.jsx)(R,{fields:g,returning:r.returning,onReturningChange:e=>o(t,n,e),schema:l,level:0})]})]},t)}})})]})}function L(e){let{fields:s,where:t,onWhereChange:n,level:l=0}=e,a=e=>{n(Object.assign(Object.assign({},t),{[e]:{_eq:""}}))},r=(e,s,l)=>{n(Object.assign(Object.assign({},t),{[e]:{[s]:l}}))},i=e=>{let s=Object.assign({},t);delete s[e],n(s)},o=w(s.filter(e=>!t[e.name])),d=S(s);return(0,c.jsxs)("div",{className:l>0?"mb-1":"mb-2",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,c.jsx)(g.Label,{className:"text-xs font-medium",children:"Where"}),(0,c.jsxs)("div",{className:"flex items-center",children:[Object.keys(t).length>0&&(0,c.jsx)(h.Button,{variant:"ghost",onClick:()=>n({}),className:"h-6 w-6 p-0 rounded-none",children:(0,c.jsx)(p.X,{className:"h-2.5 w-2.5"})}),o.length>0&&(0,c.jsxs)(x.Select,{onValueChange:e=>{a(e)},children:[(0,c.jsx)(x.SelectTrigger,{className:"square border-0 rounded-none hover:bg-destructive/10 hover:text-destructive flex-shrink-0 [&>svg:nth-child(2)]:hidden",children:(0,c.jsx)(p.Plus,{className:"h-2.5 w-2.5 flex-shrink-0"})}),(0,c.jsx)(x.SelectContent,{children:o.map(e=>(0,c.jsx)(x.SelectItem,{value:e.name,className:"text-xs",children:(0,c.jsxs)("div",{className:"flex items-center gap-1",children:[(0,c.jsx)("span",{children:e.name}),e.name===d&&(0,c.jsx)(f.Badge,{variant:"outline",className:"text-xs px-1 py-0 h-3",children:"PK"}),e.isRelation&&(0,c.jsxs)("span",{className:"text-muted-foreground",children:["(",e.targetTable,")"]})]})},e.name))})]})]})]}),(0,c.jsx)("div",{className:"space-y-1",children:Object.entries(t).map(e=>{let[t,n]=e,l=s.find(e=>e.name===t);return(0,c.jsx)(k,{fieldName:t,fieldType:(null==l?void 0:l.type)||"String",value:n,onUpdate:(e,s)=>r(t,e,s),onRemove:()=>i(t)},t)})})]})}function I(e){let{limit:s,offset:t,onLimitChange:n,onOffsetChange:l}=e;return(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(g.Label,{className:"text-xs font-medium mb-1 block",children:"Pagination"}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,c.jsxs)("div",{className:"w-full flex items-center border rounded h-6 bg-background",children:[(0,c.jsx)("div",{className:"px-2 py-1 text-xs font-medium bg-muted/50 flex-shrink-0",children:"Limit"}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsx)(b.Input,{type:"number",value:s||"",onChange:e=>{let s=Number(e.target.value);n(""===e.target.value||0===s?void 0:s)},placeholder:"10",className:"h-full border-0 rounded-none text-xs bg-transparent focus:bg-transparent px-1",min:"0"})]}),(0,c.jsxs)("div",{className:"w-full flex items-center border rounded h-6 bg-background",children:[(0,c.jsx)("div",{className:"px-2 py-1 text-xs font-medium bg-muted/50 flex-shrink-0",children:"Offset"}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsx)(b.Input,{type:"number",value:t||"",onChange:e=>{l(""===e.target.value?void 0:Number(e.target.value))},placeholder:"0",className:"h-full border-0 rounded-none text-xs bg-transparent focus:bg-transparent px-1",min:"0"})]})]})]})}function q(e){let{field:s,direction:t,onUpdate:n,onRemove:l}=e;return(0,c.jsxs)("div",{className:"w-full flex items-center border rounded h-6 bg-background",children:[(0,c.jsx)("div",{className:"px-2 py-1 text-xs font-medium bg-muted/50 flex-shrink-0",children:s}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsxs)(x.Select,{value:t,onValueChange:e=>n(s,e),children:[(0,c.jsx)(x.SelectTrigger,{className:"h-6 border-0 rounded-none px-2 text-xs bg-transparent hover:bg-muted/50 flex-shrink-0 min-w-12 max-h-full",children:(0,c.jsx)(x.SelectValue,{})}),(0,c.jsxs)(x.SelectContent,{children:[(0,c.jsx)(x.SelectItem,{value:"asc",className:"text-xs",children:"↑ asc"}),(0,c.jsx)(x.SelectItem,{value:"desc",className:"text-xs",children:"↓ desc"})]})]}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:l,className:"h-full w-6 px-0 border-0 rounded-none hover:bg-destructive/10 hover:text-destructive flex-shrink-0",children:(0,c.jsx)(p.X,{className:"h-3 w-3"})})]})}function B(e){let{fields:s,orderBy:t,onChange:n}=e,l=(e,s,l)=>{if(!t)return;let a=[...t];a[e]={[s]:l},n(a)},a=e=>{if(!t)return;let s=[...t];s.splice(e,1),n(0===s.length?void 0:s)},r=new Set((t||[]).map(e=>Object.keys(e)[0])),i=w(s.filter(e=>!r.has(e.name)));return(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,c.jsx)(g.Label,{className:"text-xs font-medium",children:"Order By"}),i.length>0&&(0,c.jsxs)(x.Select,{onValueChange:e=>{n([...t||[],{[e]:"asc"}])},children:[(0,c.jsx)(x.SelectTrigger,{className:"square border-0 rounded-none hover:bg-destructive/10 hover:text-destructive flex-shrink-0 [&>svg:nth-child(2)]:hidden",children:(0,c.jsx)(p.Plus,{className:"h-2.5 w-2.5 flex-shrink-0"})}),(0,c.jsx)(x.SelectContent,{children:i.map(e=>(0,c.jsxs)(x.SelectItem,{value:e.name,className:"text-xs",children:[e.name," ",e.isRelation&&(0,c.jsxs)("span",{className:"text-muted-foreground",children:["(",e.targetTable,")"]})]},e.name))})]})]}),(0,c.jsx)("div",{className:"space-y-1",children:(t||[]).map((e,s)=>{let t=Object.keys(e)[0],n=e[t];return(0,c.jsx)(q,{field:t,direction:n,onUpdate:(e,t)=>l(s,e,t),onRemove:()=>a(s)},"".concat(t,"-").concat(s))})})]})}function V(e){let{value:s,onChange:t,defaultTable:n="users",schema:l=N.default}=e,a=(0,o.useMemo)(()=>{var e;return l&&(null==(e=null==l?void 0:l.hasyx)?void 0:e.tableMappings)?Object.keys(l.hasyx.tableMappings).filter(e=>!e.includes("_mapping")&&!e.includes("_aggregate")&&!e.startsWith("__")&&!e.endsWith("_mutation_response")).sort():[]},[l]),r=(0,o.useMemo)(()=>l&&s.table?C(l,s.table):[],[l,s.table]),i=e=>{var n,a,r,i;let c=l?C(l,e):[],o=null==(i=null==(r=null==(a=null==(n=null==l?void 0:l.hasyx)?void 0:n.permissions)?void 0:a[e])?void 0:r.select)?void 0:i[s.role],d=[];Array.isArray(o)&&(d=c.filter(e=>!e.isRelation&&!e.name.startsWith("_hasyx_")&&o.includes(e.name)).map(e=>e.name)),0===d.length&&c.some(e=>"id"===e.name&&!e.isRelation)&&d.push("id"),t(Object.assign(Object.assign({},s),{table:e,where:{},returning:d,limit:10,offset:void 0,order_by:void 0}))};return(o.default.useEffect(()=>{if(l&&(!s.table||!a.includes(s.table))){let e=a.includes(n)?n:a[0];e&&e!==s.table&&i(e)}},[l,a,s.table,n]),l)?(0,c.jsx)("div",{className:"space-y-2",children:(0,c.jsx)(m.Card,{children:(0,c.jsxs)(m.CardContent,{className:"pt-2 pb-2",children:[(0,c.jsxs)("div",{className:"w-full flex items-center border rounded h-6 bg-background mb-2",children:[(0,c.jsx)("div",{className:"px-2 py-1 text-xs font-medium bg-muted/50 flex-shrink-0",children:"Role"}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsxs)(x.Select,{value:s.role,onValueChange:e=>{i(s.table),t(Object.assign(Object.assign({},s),{role:e}))},children:[(0,c.jsx)(x.SelectTrigger,{className:"border-0 rounded-none px-2 text-xs bg-transparent hover:bg-muted/50 flex-1 max-h-full",children:(0,c.jsx)(x.SelectValue,{placeholder:"Select role"})}),(0,c.jsxs)(x.SelectContent,{children:[(0,c.jsx)(x.SelectItem,{value:"anonymous",className:"text-xs",children:"anonymous"}),(0,c.jsx)(x.SelectItem,{value:"user",className:"text-xs",children:"user"}),(0,c.jsx)(x.SelectItem,{value:"me",className:"text-xs",children:"me"}),(0,c.jsx)(x.SelectItem,{value:"admin",className:"text-xs",children:"admin"})]})]})]}),(0,c.jsxs)("div",{className:"w-full flex items-center border rounded h-6 bg-background mb-2",children:[(0,c.jsx)("div",{className:"px-2 py-1 text-xs font-medium bg-muted/50 flex-shrink-0",children:"Table"}),(0,c.jsx)("div",{className:"w-px h-4 bg-border"}),(0,c.jsxs)(x.Select,{value:s.table,onValueChange:i,children:[(0,c.jsx)(x.SelectTrigger,{className:"border-0 rounded-none px-2 text-xs bg-transparent hover:bg-muted/50 flex-1 max-h-full",children:(0,c.jsx)(x.SelectValue,{placeholder:"Select table"})}),(0,c.jsx)(x.SelectContent,{children:a.map(e=>(0,c.jsx)(x.SelectItem,{value:e,className:"text-xs",children:e},e))})]})]}),(0,c.jsx)(L,{fields:r,where:s.where,onWhereChange:e=>{t(Object.assign(Object.assign({},s),{where:e}))}}),(0,c.jsx)(I,{limit:s.limit,offset:s.offset,onLimitChange:e=>{t(Object.assign(Object.assign({},s),{limit:e}))},onOffsetChange:e=>{t(Object.assign(Object.assign({},s),{offset:e}))}}),(0,c.jsx)(B,{fields:r,orderBy:s.order_by,onChange:e=>{t(Object.assign(Object.assign({},s),{order_by:e}))}}),(0,c.jsx)(R,{fields:r,returning:s.returning,onReturningChange:e=>{t(Object.assign(Object.assign({},s),{returning:e}))},schema:l})]})})}):(0,c.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:"Loading schema..."})}function P(e){let{constructorState:s}=e,t=S(s.table?C(null,s.table):[]),{usePk:n,pkValue:l,remainingWhere:a}=_(s.where,t),r=s.table?Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({table:s.table},n?{pk_columns:{[t]:l}}:{}),Object.keys(a).length>0?{where:a}:{}),s.limit?{limit:s.limit}:{}),s.offset?{offset:s.offset}:{}),s.order_by&&s.order_by.length>0?{order_by:s.order_by}:{}),{returning:s.returning.length>0?s.returning:["id"]}):{table:"users",where:void 0,returning:["id"]};return(0,c.jsx)(m.Card,{children:(0,c.jsx)(m.CardContent,{className:"p-2",children:(0,c.jsx)("pre",{className:"text-xs bg-muted/30 p-2 rounded overflow-auto font-mono max-h-96",children:JSON.stringify(r,null,2)})})})}function U(e){let{constructorState:s}=e,[t,n]=(0,o.useState)("query"),l=(0,d.useNewHasyx)(),a=(0,o.useMemo)(()=>{if(!s.table)return null;let e=S(C(null,s.table)),{usePk:n,pkValue:l,remainingWhere:a}=_(s.where,e);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({operation:t,table:s.table},n?{pk_columns:{[e]:l}}:{}),Object.keys(a).length>0?{where:a}:{}),s.limit?{limit:s.limit}:{}),s.offset?{offset:s.offset}:{}),s.order_by&&s.order_by.length>0?{order_by:s.order_by}:{}),{returning:s.returning.length>0?s.returning:["id"]})},[s,t]),r=(0,o.useMemo)(()=>{if(!a||!(null==l?void 0:l.generate))return null;try{return l.generate(a)}catch(e){return{error:(null==e?void 0:e.message)||"Unknown error"}}},[a,null==l?void 0:l.generate]);return(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)(j.Tabs,{value:t,onValueChange:e=>n(e),children:(0,c.jsxs)(j.TabsList,{className:"grid w-full grid-cols-2",children:[(0,c.jsx)(j.TabsTrigger,{value:"query",className:"text-xs h-full",children:"query"}),(0,c.jsx)(j.TabsTrigger,{value:"subscription",className:"text-xs h-full",children:"subscription"})]})}),(0,c.jsxs)(m.Card,{children:[(0,c.jsx)(m.CardHeader,{className:"pb-1",children:(0,c.jsx)(m.CardTitle,{className:"text-xs",children:"GraphQL Query"})}),(0,c.jsx)(m.CardContent,{className:"pt-0 pb-2",children:r&&"error"in r?(0,c.jsx)("div",{className:"text-red-500 text-xs",children:(0,c.jsx)("pre",{className:"whitespace-pre-wrap text-xs",children:r.error})}):(0,c.jsx)("pre",{className:"text-xs bg-muted/30 p-2 rounded overflow-auto font-mono max-h-48",children:(null==r?void 0:r.queryString)||"Loading..."})})]}),(0,c.jsxs)(m.Card,{children:[(0,c.jsx)(m.CardHeader,{className:"pb-1",children:(0,c.jsx)(m.CardTitle,{className:"text-xs",children:"Variables"})}),(0,c.jsx)(m.CardContent,{className:"pt-0 pb-2",children:(0,c.jsx)("pre",{className:"text-xs bg-muted/30 p-2 rounded overflow-auto font-mono max-h-48",children:r&&"variables"in r?JSON.stringify(r.variables,null,2):"{}"})})]})]})}function A(e){let{constructorState:s}=e,t=S(s.table?C(null,s.table):[]),{usePk:n,pkValue:l,remainingWhere:a}=_(s.where,t),r=s.table?Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({table:s.table},n?{pk_columns:{[t]:l}}:{}),Object.keys(a).length>0?{where:a}:{}),s.limit?{limit:s.limit}:{}),s.offset?{offset:s.offset}:{}),s.order_by&&s.order_by.length>0?{order_by:s.order_by}:{}),{returning:s.returning.length>0?s.returning:["id"]}):{table:"users",where:void 0,returning:["id"]},{data:i,loading:o,error:u}=(0,d.useQuery)(r);return(0,c.jsx)(m.Card,{children:(0,c.jsxs)(m.CardContent,{className:"p-2",children:[o&&(0,c.jsx)("div",{className:"text-muted-foreground text-xs",children:"Loading..."}),u&&(0,c.jsx)("div",{className:"text-red-500 text-xs",children:(0,c.jsx)("pre",{className:"whitespace-pre-wrap text-xs",children:JSON.stringify(u,null,2)})}),i&&(0,c.jsx)("pre",{className:"text-xs bg-muted/30 p-2 rounded overflow-auto font-mono max-h-96",children:JSON.stringify(i,null,2)})]})})}function M(e){let{constructorState:s}=e,t=S(s.table?C(null,s.table):[]),{usePk:n,pkValue:l,remainingWhere:a}=_(s.where,t),r=s.table?Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({table:s.table},n?{pk_columns:{[t]:l}}:{}),Object.keys(a).length>0?{where:a}:{}),s.limit?{limit:s.limit}:{}),s.offset?{offset:s.offset}:{}),s.order_by&&s.order_by.length>0?{order_by:s.order_by}:{}),{returning:s.returning.length>0?s.returning:["id"]}):{table:"users",where:void 0,returning:["id"]},{data:i,loading:o,error:u}=(0,d.useSubscription)(r);return(0,c.jsx)(m.Card,{children:(0,c.jsxs)(m.CardContent,{className:"p-2",children:[o&&(0,c.jsx)("div",{className:"text-muted-foreground text-xs",children:"Loading subscription..."}),u&&(0,c.jsx)("div",{className:"text-red-500 text-xs",children:(0,c.jsx)("pre",{className:"whitespace-pre-wrap text-xs",children:JSON.stringify(u,null,2)})}),i&&(0,c.jsx)("pre",{className:"text-xs bg-muted/30 p-2 rounded overflow-auto font-mono max-h-96",children:JSON.stringify(i,null,2)})]})})}function z(e){let{constructorState:s}=e;return(0,c.jsx)("div",{className:"h-full",children:(0,c.jsxs)(j.Tabs,{defaultValue:"exp",className:"w-full h-full flex flex-col",children:[(0,c.jsxs)(j.TabsList,{className:"grid w-full grid-cols-4",children:[(0,c.jsx)(j.TabsTrigger,{value:"exp",className:"text-xs",children:"exp"}),(0,c.jsx)(j.TabsTrigger,{value:"gql",className:"text-xs",children:"gql"}),(0,c.jsx)(j.TabsTrigger,{value:"query",className:"text-xs",children:"query"}),(0,c.jsx)(j.TabsTrigger,{value:"subscription",className:"text-xs",children:"subscription"})]}),(0,c.jsx)(j.TabsContent,{value:"exp",className:"mt-2 flex-1",children:(0,c.jsx)(P,{constructorState:s})}),(0,c.jsx)(j.TabsContent,{value:"gql",className:"mt-2 flex-1",children:(0,c.jsx)(U,{constructorState:s})}),(0,c.jsx)(j.TabsContent,{value:"query",className:"mt-2 flex-1",children:(0,c.jsx)(A,{constructorState:s})}),(0,c.jsx)(j.TabsContent,{value:"subscription",className:"mt-2 flex-1",children:(0,c.jsx)(M,{constructorState:s})})]})})}function W(e){let{value:s,onChange:t,defaultTable:n="users",schema:l=N.default}=e;return(0,c.jsxs)("div",{className:"flex flex-1 h-full",children:[(0,c.jsxs)("div",{className:"flex-1 p-2 border-r overflow-auto",children:[(0,c.jsx)("h2",{className:"text-base font-semibold mb-2",children:"Query Constructor"}),(0,c.jsx)(V,{value:s,onChange:t,defaultTable:n,schema:l})]}),(0,c.jsxs)("div",{className:"flex-1 p-2 overflow-auto",children:[(0,c.jsx)("h2",{className:"text-base font-semibold mb-2",children:"Query Results"}),(0,c.jsx)(z,{constructorState:s})]})]})}function E(e){let{value:s,onChange:t,defaultTable:n="users",schema:l=N.default}=e;return(0,c.jsx)("div",{className:"w-full h-full",children:(0,c.jsxs)(j.Tabs,{defaultValue:"constructor",className:"w-full h-full flex flex-col",children:[(0,c.jsxs)(j.TabsList,{className:"grid w-full grid-cols-2",children:[(0,c.jsx)(j.TabsTrigger,{value:"constructor",className:"text-xs",children:"Constructor"}),(0,c.jsx)(j.TabsTrigger,{value:"results",className:"text-xs",children:"Results"})]}),(0,c.jsx)(j.TabsContent,{value:"constructor",className:"mt-2 flex-1 overflow-auto",children:(0,c.jsx)(V,{value:s,onChange:t,defaultTable:n,schema:l})}),(0,c.jsx)(j.TabsContent,{value:"results",className:"mt-2 flex-1 overflow-auto",children:(0,c.jsx)(z,{constructorState:s})})]})})}}}]);