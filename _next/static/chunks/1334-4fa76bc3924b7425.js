"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1334],{84170:function(e,t,s){var a=this&&this.__awaiter||function(e,t,s,a){return new(s||(s=Promise))(function(n,r){function i(e){try{o(a.next(e))}catch(e){r(e)}}function l(e){try{o(a.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.usePWA=function(){let[e,t]=(0,n.useState)({isSupported:!1,isInstalled:!1,installPromptAvailable:!1,updateAvailable:!1,displayMode:"browser",isInitialized:!1}),[s,i]=(0,n.useState)(null);(0,n.useEffect)(()=>{a(this,void 0,void 0,function*(){let e=yield(0,r.initializePWA)();e?(t(t=>Object.assign(Object.assign({},t),{isSupported:!0,isInstalled:e.isPWA,installPromptAvailable:e.installPrompt.isAvailable,displayMode:e.displayMode,isInitialized:!0})),i(()=>e.installPrompt.prompt)):t(e=>Object.assign(Object.assign({},e),{isInitialized:!0}))})},[]),(0,n.useEffect)(()=>{let e=()=>{t(e=>Object.assign(Object.assign({},e),{installPromptAvailable:!0}))},s=()=>{t(e=>Object.assign(Object.assign({},e),{isInstalled:!0,installPromptAvailable:!1}))},a=()=>{t(e=>Object.assign(Object.assign({},e),{updateAvailable:!0}))},n=e=>{console.log("iOS installation instructions:",e.detail.message)};return window.addEventListener("pwa-install-available",e),window.addEventListener("pwa-installed",s),window.addEventListener("sw-update-available",a),window.addEventListener("pwa-ios-instructions",n),()=>{window.removeEventListener("pwa-install-available",e),window.removeEventListener("pwa-installed",s),window.removeEventListener("sw-update-available",a),window.removeEventListener("pwa-ios-instructions",n)}},[]);let l=(0,n.useCallback)(()=>a(this,void 0,void 0,function*(){if(s)try{yield s()}catch(e){console.error("Failed to show install prompt:",e)}}),[s]),o=(0,n.useCallback)(()=>a(this,void 0,void 0,function*(){try{yield(0,r.updateServiceWorker)()}catch(e){console.error("Failed to update service worker:",e)}}),[]),c=(0,n.useCallback)(()=>{t(e=>Object.assign(Object.assign({},e),{updateAvailable:!1}))},[]);return Object.assign(Object.assign({},e),{install:l,update:o,showNotification:r.showNotification,dismissUpdate:c})};let n=s(12115),r=s(85195)},91334:(e,t,s)=>{var a=Object.create?function(e,t,s,a){void 0===a&&(a=s);var n=Object.getOwnPropertyDescriptor(t,s);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,a,n)}:function(e,t,s,a){void 0===a&&(a=s),e[a]=t[s]},n=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},r=function(){var e=function(t){return(e=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t})(t)};return function(t){if(t&&t.__esModule)return t;var s={};if(null!=t)for(var r=e(t),i=0;i<r.length;i++)"default"!==r[i]&&a(s,t,r[i]);return n(s,t),s}}(),i=function(e,t,s,a){return new(s||(s=Promise))(function(n,r){function i(e){try{o(a.next(e))}catch(e){r(e)}}function l(e){try{o(a.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};t.A=function(e){let{serverSession:t,sidebarData:a}=e,[n,v]=(0,o.useState)("undefined"==typeof navigator||navigator.onLine),[g,w]=(0,o.useState)([]),[j,y]=(0,o.useState)({canInstall:!1,isInstalled:!1,platform:"unknown"}),[b,C]=(0,o.useState)([]),[N,k]=(0,o.useState)(!1),[S,P]=(0,o.useState)(!1),{isSupported:A,isInstalled:W,installPromptAvailable:I,updateAvailable:T,displayMode:O,isInitialized:$,install:B,update:F}=(0,p.usePWA)();(0,o.useEffect)(()=>{let e=()=>v(!0),t=()=>v(!1);if("undefined"!=typeof window)return window.addEventListener("online",e),window.addEventListener("offline",t),v(navigator.onLine),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),(0,o.useEffect)(()=>{D()},[]),(0,o.useEffect)(()=>{E()},[W,I]);let D=()=>i(this,void 0,void 0,function*(){try{if("undefined"!=typeof window&&"caches"in window){let e=yield caches.keys(),t=[];for(let s of e){let e=yield caches.open(s),a=yield e.keys();t.push({name:s,size:0,lastModified:new Date,entries:a.length})}w(t)}}catch(e){console.error("Failed to load cache info:",e)}}),E=()=>{if("undefined"==typeof window||"undefined"==typeof navigator)return;let e=navigator.userAgent,t=/iPad|iPhone|iPod/.test(e),s=/Android/.test(e),a=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone,n="desktop";t?n="ios":s&&(n="android");let r="";a?r="Already installed and running in standalone mode":A?t&&!/Safari/.test(e)?r="iOS requires Safari browser for PWA installation":I||(r="Browser install prompt not available (may need user engagement)"):r="PWA not supported on this browser/device",y({canInstall:I&&!W,isInstalled:a||W,platform:n,reason:r})},_=e=>i(this,void 0,void 0,function*(){try{if("undefined"==typeof window)return;if(e){let{clearCache:t}=yield Promise.resolve().then(()=>r(s(95924)));yield t(e)}else{let{clearAllCaches:e}=yield Promise.resolve().then(()=>r(s(95924))),t=yield e();t.success&&"Notification"in window&&"granted"===Notification.permission&&(0,x.showNotification)("Cache Cleared",{body:"Cleared ".concat(t.clearedCaches.length," caches, freed ~").concat(Math.round(t.totalBytesFreed/1024),"KB"),tag:"cache-clear"})}yield D()}catch(e){console.error("Failed to clear cache:",e)}}),R=e=>{switch(e){case"passed":return(0,l.jsx)(m.CheckCircle,{className:"h-4 w-4 text-green-600"});case"warning":return(0,l.jsx)(m.AlertCircle,{className:"h-4 w-4 text-yellow-600"});case"failed":return(0,l.jsx)(m.XCircle,{className:"h-4 w-4 text-red-600"});default:return(0,l.jsx)(m.AlertCircle,{className:"h-4 w-4 text-gray-400"})}};return(0,l.jsx)(c.SidebarLayout,{sidebarData:a,breadcrumb:[{title:"Hasyx",link:"/"},{title:"PWA Diagnostics",link:"/hasyx/pwa"}],children:(0,l.jsxs)("div",{className:"flex flex-1 flex-col gap-4 p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold",children:"PWA Diagnostics"}),n?(0,l.jsxs)(h.Badge,{variant:"default",className:"flex items-center gap-1",children:[(0,l.jsx)(m.Wifi,{className:"h-3 w-3"}),"Online"]}):(0,l.jsxs)(h.Badge,{variant:"destructive",className:"flex items-center gap-1",children:[(0,l.jsx)(m.WifiOff,{className:"h-3 w-3"}),"Offline"]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(u.Button,{onClick:()=>i(this,void 0,void 0,function*(){try{if("undefined"==typeof window)return;let{forceReloadFromServer:e}=yield Promise.resolve().then(()=>r(s(95924)));yield e()}catch(e){console.error("Failed to force update:",e),yield(0,x.updateServiceWorker)()}}),variant:"outline",size:"sm",children:[(0,l.jsx)(m.RefreshCw,{className:"h-4 w-4 mr-2"}),"Force Update"]}),j.canInstall&&(0,l.jsxs)(u.Button,{onClick:B,size:"sm",children:[(0,l.jsx)(m.Download,{className:"h-4 w-4 mr-2"}),"Install PWA"]})]})]}),(0,l.jsxs)(f.Tabs,{defaultValue:"overview",className:"flex-1",children:[(0,l.jsxs)(f.TabsList,{className:"grid w-full grid-cols-5",children:[(0,l.jsx)(f.TabsTrigger,{value:"overview",children:"Overview"}),(0,l.jsx)(f.TabsTrigger,{value:"tests",children:"Tests"}),(0,l.jsx)(f.TabsTrigger,{value:"cache",children:"Cache"}),(0,l.jsx)(f.TabsTrigger,{value:"install",children:"Install"}),(0,l.jsx)(f.TabsTrigger,{value:"uninstall",children:"Uninstall"})]}),(0,l.jsxs)(f.TabsContent,{value:"overview",className:"space-y-4",children:[(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[(0,l.jsxs)(d.Card,{children:[(0,l.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"PWA Status"}),(0,l.jsx)(m.Smartphone,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsxs)(d.CardContent,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:j.isInstalled?"Installed":"Web App"}),(0,l.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Platform: ",j.platform]}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)(h.Badge,{variant:A?"default":"destructive",children:A?"Supported":"Not Supported"})})]})]}),(0,l.jsxs)(d.Card,{children:[(0,l.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Display Mode"}),(0,l.jsx)(m.Monitor,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsxs)(d.CardContent,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold capitalize",children:O||(0,x.getPWADisplayMode)()}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,x.isPWA)()?"Running as PWA":"Running in browser"})]})]}),(0,l.jsxs)(d.Card,{children:[(0,l.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Cache Status"}),(0,l.jsx)(m.Database,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsxs)(d.CardContent,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:g.length}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active caches"}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsxs)(h.Badge,{variant:"outline",children:[g.reduce((e,t)=>e+t.entries,0)," entries"]})})]})]})]}),b.length>0&&(0,l.jsxs)(d.Card,{children:[(0,l.jsx)(d.CardHeader,{children:(0,l.jsx)(d.CardTitle,{children:"Recent Test Results"})}),(0,l.jsx)(d.CardContent,{children:(0,l.jsx)("div",{className:"space-y-2",children:b.slice(0,5).map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[R(e.status),(0,l.jsx)("span",{className:"text-sm font-medium",children:e.name})]}),(0,l.jsx)(h.Badge,{variant:"passed"===e.status?"default":"warning"===e.status?"secondary":"destructive",children:e.status})]},t))})})]})]}),(0,l.jsx)(f.TabsContent,{value:"tests",className:"space-y-4",children:(0,l.jsxs)(d.Card,{children:[(0,l.jsx)(d.CardHeader,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(d.CardTitle,{children:"PWA Stability Tests"}),(0,l.jsxs)(u.Button,{onClick:()=>i(this,void 0,void 0,function*(){if("undefined"==typeof window)return;k(!0);let e=[],t=(0,x.checkPWASupport)();e.push({name:"PWA Support",status:t&&t.serviceWorker?"passed":"failed",message:t&&t.serviceWorker?"Browser supports PWA features":"Browser lacks PWA support",details:t});try{let t=yield fetch("/manifest.webmanifest"),s=yield t.json();e.push({name:"Web App Manifest",status:t.ok?"passed":"failed",message:t.ok?"Manifest loaded: ".concat(s.name):"Manifest not found",details:s})}catch(t){e.push({name:"Web App Manifest",status:"failed",message:"Failed to load manifest",details:t})}try{let t=yield fetch("/sw.js");e.push({name:"Service Worker",status:t.ok?"passed":"failed",message:t.ok?"Service worker file accessible":"Service worker not found",details:{status:t.status}})}catch(t){e.push({name:"Service Worker",status:"failed",message:"Service worker not accessible",details:t})}let s="undefined"!=typeof window&&window.isSecureContext,a="undefined"!=typeof window?window.location.protocol:"unknown";e.push({name:"Secure Context",status:s?"passed":"failed",message:s?"Running on HTTPS":"HTTPS required for PWA",details:{protocol:a}});let r="undefined"!=typeof window&&"Notification"in window?Notification.permission:"not-supported";e.push({name:"Notifications",status:"granted"===r?"passed":"default"===r?"warning":"failed",message:"Notification permission: ".concat(r),details:{permission:r}});let i="undefined"!=typeof window&&"caches"in window;e.push({name:"Cache API",status:i?"passed":"failed",message:i?"Cache API available":"Cache API not supported",details:{supported:i}}),e.push({name:"Network Status",status:n?"passed":"warning",message:n?"Online":"Offline (testing offline capability)",details:{online:n}}),e.push({name:"Installation",status:j.isInstalled?"passed":j.canInstall?"warning":"failed",message:j.isInstalled?"PWA is installed":j.canInstall?"Can be installed":"Cannot be installed",details:j}),C(e),k(!1)}),disabled:N,className:"flex items-center gap-2",children:[(0,l.jsx)(m.Code,{className:"h-4 w-4"}),N?"Running Tests...":"Run Tests"]})]})}),(0,l.jsx)(d.CardContent,{children:0===b.length?(0,l.jsx)("p",{className:"text-muted-foreground text-center py-8",children:'Click "Run Tests" to start PWA stability testing'}):(0,l.jsx)("div",{className:"space-y-3",children:b.map((e,t)=>(0,l.jsxs)("div",{className:"border rounded p-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[R(e.status),(0,l.jsx)("span",{className:"font-medium",children:e.name})]}),(0,l.jsx)(h.Badge,{variant:"passed"===e.status?"default":"warning"===e.status?"secondary":"destructive",children:e.status})]}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:e.message}),e.details&&(0,l.jsxs)("details",{className:"mt-2",children:[(0,l.jsx)("summary",{className:"cursor-pointer text-xs text-blue-600",children:"Show details"}),(0,l.jsx)("pre",{className:"mt-1 p-2 bg-gray-100 rounded text-xs overflow-x-auto",children:JSON.stringify(e.details,null,2)})]})]},t))})})]})}),(0,l.jsx)(f.TabsContent,{value:"cache",className:"space-y-4",children:(0,l.jsxs)(d.Card,{children:[(0,l.jsx)(d.CardHeader,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(d.CardTitle,{children:"Cache Management"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(u.Button,{onClick:D,variant:"outline",size:"sm",children:[(0,l.jsx)(m.RefreshCw,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,l.jsxs)(u.Button,{onClick:()=>_(),variant:"destructive",size:"sm",children:[(0,l.jsx)(m.Trash2,{className:"h-4 w-4 mr-2"}),"Clear All"]})]})]})}),(0,l.jsx)(d.CardContent,{children:0===g.length?(0,l.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No caches found"}):(0,l.jsx)("div",{className:"space-y-3",children:g.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium",children:e.name}),(0,l.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.entries," entries"]})]}),(0,l.jsxs)(u.Button,{onClick:()=>_(e.name),variant:"outline",size:"sm",children:[(0,l.jsx)(m.Trash2,{className:"h-4 w-4 mr-1"}),"Clear"]})]},t))})})]})}),(0,l.jsx)(f.TabsContent,{value:"install",className:"space-y-4",children:(0,l.jsxs)(d.Card,{children:[(0,l.jsx)(d.CardHeader,{children:(0,l.jsx)(d.CardTitle,{children:"Installation Status"})}),(0,l.jsx)(d.CardContent,{className:"space-y-4",children:(0,l.jsxs)("div",{className:"grid gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium",children:"Current Status"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:j.isInstalled?"PWA is installed":"Running as web app"})]}),(0,l.jsx)(h.Badge,{variant:j.isInstalled?"default":"secondary",children:j.isInstalled?"Installed":"Not Installed"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium",children:"Platform"}),(0,l.jsxs)("p",{className:"text-sm text-muted-foreground",children:[j.platform," - ","undefined"!=typeof navigator?navigator.userAgent.substring(0,50)+"...":"User agent not available"]})]}),(0,l.jsx)(h.Badge,{variant:"outline",children:j.platform})]}),j.reason&&(0,l.jsxs)("div",{className:"p-4 border rounded bg-muted/50",children:[(0,l.jsx)("h4",{className:"font-medium mb-2",children:"Installation Info"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:j.reason})]}),j.canInstall&&(0,l.jsxs)(u.Button,{onClick:B,className:"w-full",children:[(0,l.jsx)(m.Download,{className:"h-4 w-4 mr-2"}),"Install PWA"]})]})})]})}),(0,l.jsx)(f.TabsContent,{value:"uninstall",className:"space-y-4",children:(0,l.jsxs)(d.Card,{children:[(0,l.jsx)(d.CardHeader,{children:(0,l.jsx)(d.CardTitle,{className:"text-red-600",children:"PWA Uninstall & Reset"})}),(0,l.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-4",children:[(0,l.jsx)("h4",{className:"font-medium text-red-800 mb-2",children:"⚠️ Warning"}),(0,l.jsx)("p",{className:"text-sm text-red-700",children:"This will completely reset the PWA by clearing all cached data, unregistering service workers, and removing all local storage. The page will reload automatically."})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)("h4",{className:"font-medium",children:"What will be cleared:"}),(0,l.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,l.jsx)("li",{children:"• All cache storage"}),(0,l.jsx)("li",{children:"• Service worker registrations"}),(0,l.jsx)("li",{children:"• Local storage data"}),(0,l.jsx)("li",{children:"• Session storage data"}),(0,l.jsx)("li",{children:"• IndexedDB databases"})]})]}),(0,l.jsxs)(u.Button,{onClick:()=>i(this,void 0,void 0,function*(){if("undefined"!=typeof window){P(!0);try{let{completePWAReset:e}=yield Promise.resolve().then(()=>r(s(95924))),t=yield e();t.success?("Notification"in window&&"granted"===Notification.permission&&(0,x.showNotification)("PWA Reset Complete",{body:"".concat(t.actions.length," actions completed. Page will reload shortly."),tag:"pwa-uninstall"}),setTimeout(()=>{window.location.reload()},2e3)):console.error("PWA reset failed:",t.errors)}catch(e){console.error("Failed to uninstall PWA:",e)}finally{P(!1)}}}),variant:"destructive",disabled:S,className:"w-full",children:[(0,l.jsx)(m.Trash2,{className:"h-4 w-4 mr-2"}),S?"Uninstalling...":"Complete PWA Reset"]}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Note: This doesn't remove the PWA from your home screen. You'll need to manually remove it from your device."})]})]})})]})]})})};let l=s(95155),o=s(12115),c=s(2693),d=s(53959),u=s(51825),h=s(51364),f=s(76862),m=s(47937),p=s(84170),x=s(85195)},95924:function(e,t,s){var a=this&&this.__awaiter||function(e,t,s,a){return new(s||(s=Promise))(function(n,r){function i(e){try{o(a.next(e))}catch(e){r(e)}}function l(e){try{o(a.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getCacheDetails=i,t.clearCache=l,t.clearAllCaches=o,t.forceReloadFromServer=function(){return a(this,void 0,void 0,function*(){r("Forcing reload from server...");try{yield o(),localStorage.clear(),sessionStorage.clear(),r("Cleared local storage");let e=new URL(window.location.href);e.searchParams.set("_cache_bust",Date.now().toString()),window.location.replace(e.toString())}catch(e){r("Failed to force reload:",e),window.location.reload()}})},t.unregisterAllServiceWorkers=c,t.completePWAReset=function(){return a(this,void 0,void 0,function*(){let e={success:!0,actions:[],errors:[]};r("Starting complete PWA reset...");try{let t=yield o();t.success?e.actions.push(`Cleared ${t.clearedCaches.length} caches`):e.errors.push(...t.errors);let s=yield c();s.length>0&&e.actions.push(`Unregistered ${s.length} service workers`);try{localStorage.clear(),sessionStorage.clear(),e.actions.push("Cleared local and session storage")}catch(t){e.errors.push(`Failed to clear storage: ${t}`)}try{if("indexedDB"in window&&indexedDB.databases){let t=yield indexedDB.databases();for(let e of t)e.name&&(yield new Promise((t,s)=>{let a=indexedDB.deleteDatabase(e.name);a.onsuccess=()=>t(),a.onerror=()=>s(a.error),a.onblocked=()=>{r(`Database deletion blocked: ${e.name}`),t()}}));e.actions.push(`Cleared ${t.length} IndexedDB databases`)}}catch(t){e.errors.push(`Failed to clear IndexedDB: ${t}`)}try{document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+new Date().toUTCString()+";path=/")}),e.actions.push("Cleared cookies")}catch(t){e.errors.push(`Failed to clear cookies: ${t}`)}e.success=0===e.errors.length,r(`PWA reset complete. Success: ${e.success}`),r("Actions taken:",e.actions),e.errors.length>0&&r("Errors:",e.errors)}catch(t){e.success=!1,e.errors.push(`Unexpected error during reset: ${t}`),r("Unexpected error during PWA reset:",t)}return e})},t.checkForStaleContent=d,t.smartCacheRefresh=function(){return a(this,void 0,void 0,function*(){r("Performing smart cache refresh...");let e={refreshed:!1,reason:"",actions:[]};try{if((yield d()).isStale){for(let t of(e.refreshed=!0,e.reason="Stale content detected",(yield i()).filter(e=>e.name.includes("runtime")||e.name.includes("precache")||e.name.includes("workbox"))))yield l(t.name),e.actions.push(`Cleared ${t.name}`);r(`Smart refresh completed: ${e.actions.length} caches cleared`)}else e.reason="Content is up-to-date",r("No refresh needed - content is current")}catch(t){e.reason=`Error during smart refresh: ${t}`,r("Smart cache refresh error:",t)}return e})},t.exportCacheDebugInfo=function(){return a(this,void 0,void 0,function*(){return JSON.stringify({timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,caches:yield i(),serviceWorkers:yield a(this,void 0,void 0,function*(){if(!("serviceWorker"in navigator))return[];try{return(yield navigator.serviceWorker.getRegistrations()).map(e=>{var t,s;return{scope:e.scope,state:(null==(t=e.active)?void 0:t.state)||"unknown",scriptURL:(null==(s=e.active)?void 0:s.scriptURL)||"unknown"}})}catch(e){return[]}}),storage:{localStorage:Object.keys(localStorage).length,sessionStorage:Object.keys(sessionStorage).length},staleCheck:yield d()},null,2)})};let r=(0,n(s(74684)).default)("pwa-cache");function i(){return a(this,void 0,void 0,function*(){if(!("caches"in window))return r("Cache API not supported"),[];try{let e=yield caches.keys(),t=[];for(let s of e){let e=yield caches.open(s),a=yield e.keys(),n=0,r=[];for(let e of a)r.push(e.url),n+=1024;t.push({name:s,entries:a.length,estimatedSize:n,lastModified:new Date,keys:r})}return r(`Found ${t.length} caches with total ${t.reduce((e,t)=>e+t.entries,0)} entries`),t}catch(e){return r("Failed to get cache details:",e),[]}})}function l(e){return a(this,void 0,void 0,function*(){if(!("caches"in window))return r("Cache API not supported"),!1;try{let t=yield caches.delete(e);return r(`Cache "${e}" ${t?"deleted successfully":"not found or failed to delete"}`),t}catch(t){return r(`Failed to clear cache "${e}":`,t),!1}})}function o(){return a(this,void 0,void 0,function*(){let e={success:!0,clearedCaches:[],errors:[],totalBytesFreed:0};if(!("caches"in window))return e.success=!1,e.errors.push("Cache API not supported"),e;try{let t=yield caches.keys();for(let s of(r(`Clearing ${t.length} caches...`),e.totalBytesFreed=(yield i()).reduce((e,t)=>e+t.estimatedSize,0),t))try{(yield caches.delete(s))?(e.clearedCaches.push(s),r(`✓ Cleared cache: ${s}`)):(e.errors.push(`Failed to delete cache: ${s}`),r(`✗ Failed to clear cache: ${s}`))}catch(t){e.errors.push(`Error deleting cache ${s}: ${t}`),r(`✗ Error clearing cache ${s}:`,t)}e.success=0===e.errors.length,r(`Cache cleanup complete. Success: ${e.success}, Cleared: ${e.clearedCaches.length}, Errors: ${e.errors.length}`)}catch(t){e.success=!1,e.errors.push(`Failed to enumerate caches: ${t}`),r("Failed to enumerate caches:",t)}return e})}function c(){return a(this,void 0,void 0,function*(){let e=[];if(!("serviceWorker"in navigator))return r("Service Worker not supported"),e;try{let t=yield navigator.serviceWorker.getRegistrations();for(let s of(r(`Found ${t.length} service worker registrations`),t))try{let t=s.scope;(yield s.unregister())?(e.push(t),r(`✓ Unregistered service worker: ${t}`)):r(`✗ Failed to unregister service worker: ${t}`)}catch(e){r(`✗ Error unregistering service worker:`,e)}}catch(e){r("Failed to get service worker registrations:",e)}return e})}function d(){return a(this,void 0,void 0,function*(){r("Checking for stale content...");let e={isStale:!1,lastCheck:new Date,recommendation:"Content appears to be up-to-date"};try{let t=yield fetch("/api/version?_="+Date.now(),{cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(t.ok){let s=yield t.json();e.serverVersion=s.version||s.timestamp;let a=localStorage.getItem("app_version");e.cachedVersion=a||"unknown",a&&e.serverVersion&&a!==e.serverVersion?(e.isStale=!0,e.recommendation="New version available. Consider clearing cache and reloading.",r(`Stale content detected. Cached: ${a}, Server: ${e.serverVersion}`)):r("Content is up-to-date"),e.serverVersion&&localStorage.setItem("app_version",e.serverVersion)}else e.recommendation="Unable to check for updates. Consider refreshing if experiencing issues.",r("Failed to check server version:",t.status)}catch(t){e.recommendation="Network error while checking for updates. Refresh if needed.",r("Error checking for stale content:",t)}return e})}}}]);