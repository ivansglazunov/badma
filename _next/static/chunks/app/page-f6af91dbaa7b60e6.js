(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{12730:(e,s,t)=>{"use strict";t.d(s,{j:()=>n});var a=t(95155),l=t(12115),r=t(50348);t(26366);let n=e=>{let s,t,{children:n,force:i=.5,className:o="",disabled:c=!1,maxRotation:d=15,maxLift:u=30,enableGlow:m=!0,useDeviceOrientation:x=!0,orientationSensitivity:h=.8,returnToCenter:p=1500,onOrientationData:g}=e,[f,j]=(0,l.useState)(!1),[b,v]=(0,l.useState)({x:0,y:0}),[N,w]=(0,l.useState)({x:0,y:0}),[y,_]=(0,l.useState)(!1),[k,C]=(0,l.useState)(!1),[A,S]=(0,l.useState)(null),I=(0,l.useRef)(null),T=(0,l.useRef)(null),D=(0,l.useRef)(null),E=(0,l.useRef)({x:0,y:0}),{width:M,height:U,ref:B}=(0,r.A)({refreshMode:"debounce",refreshRate:100});(0,l.useEffect)(()=>{if(x&&!c)return(()=>{if(window.DeviceOrientationEvent){_(!0);let e=e=>{let s=Date.now();if(S({alpha:e.alpha,beta:e.beta,gamma:e.gamma,timestamp:s}),null===e.gamma||null===e.beta)return;C(!0);let t=Math.max(-90,Math.min(90,e.gamma)),a=Math.max(-90,Math.min(90,e.beta)),l=T.current;if(l){let e=t-l.gamma,s=a-l.beta,r=E.current,n=-(e/90)*h*.5,i=-(s/90)*h*.5,o=Math.max(-1,Math.min(1,r.x+n)),c=Math.max(-1,Math.min(1,r.y+i));E.current={x:o,y:c},v({x:o,y:c})}T.current={gamma:t,beta:a}};return window.addEventListener("deviceorientation",e,!0),()=>{window.removeEventListener("deviceorientation",e,!0)}}})()},[x,c,h,p]),(0,l.useEffect)(()=>{if(x&&!c)return D.current=setInterval(()=>{let e=E.current,s=Math.sqrt(e.x*e.x+e.y*e.y);if(s>.01){let s=.95*e.x,t=.95*e.y;E.current={x:s,y:t},v({x:s,y:t})}else s>0&&(E.current={x:0,y:0},v({x:0,y:0}),C(!1))},16),()=>{D.current&&clearInterval(D.current)}},[x,c]),(0,l.useEffect)(()=>{g&&(A?g({...A,isSupported:y,isActive:k}):g({alpha:null,beta:null,gamma:null,timestamp:Date.now(),isSupported:y,isActive:k}))},[A,y,k,g]);let F=(0,l.useCallback)(()=>{if(!c&&!k&&(j(!0),I.current)){let e=I.current.getBoundingClientRect();w({x:e.left+e.width/2,y:e.top+e.height/2})}},[c,k]),O=(0,l.useCallback)(()=>{c||k||(j(!1),v({x:0,y:0}))},[c,k]),L=(0,l.useCallback)(e=>{if(c||k||!f||!I.current)return;let s=I.current.getBoundingClientRect(),t=s.left+s.width/2,a=s.top+s.height/2;v({x:(e.clientX-t)/(s.width/2),y:(e.clientY-a)/(s.height/2)})},[c,k,f]),R=(0,l.useCallback)(e=>{},[]);k?(s=-b.y*i*d*3,t=b.x*i*d*3):(s=b.y*i*d*.25,t=-b.x*i*d*.25);let z={transform:"\n      perspective(1200px) \n      rotateX(".concat(s,"deg) \n      rotateY(").concat(t,"deg)\n    "),boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",transition:f||k?"transform 0.08s ease-out, box-shadow 0.2s ease-out":"transform 0.4s cubic-bezier(0.23, 1, 0.320, 1), box-shadow 0.4s ease-out"},q=(0,l.useCallback)(e=>{I.current=e,B(e)},[B]);return(0,a.jsx)("div",{ref:q,className:"hover-card ".concat(o),style:{...z,width:M?"".concat(M,"px"):"auto",height:U?"".concat(U,"px"):"auto",transformStyle:"preserve-3d"},onMouseEnter:F,onMouseLeave:O,onMouseMove:L,onClick:R,children:n})}},15038:(e,s,t)=>{"use strict";t.d(s,{default:()=>eW});var a=t(95155),l=t(51154),r=t(69037),n=t(34869),i=t(93550),o=t(18186),c=t(17951),d=t(49103),u=t(17580),m=t(50142),x=t(71007),h=t(6752),p=t(40288),g=t(54416),f=t(12108),j=t(12115),b=t(80239),v=t(259),N=t(17180),w=t(48019),y=t(98717),_=t(76862),k=t(2464),C=t(8619),A=t(46896),S=t(29535),I=t(51364),T=t(51825),D=t(56671),E=t(23464),M=t(23806),U=t(13853);let B=(0,U.A)("axios-client");class F extends M.g{async _create(e){return this.sendRequest(e)}async _perk(e){return this.sendRequest(e)}async _join(e){return this.sendRequest(e)}async _leave(e){return this.sendRequest(e)}async _move(e){return this.sendRequest(e)}async _sync(e){return this.sendRequest(e)}async sendRequest(e){let s="".concat("https://badma-dev.deep.foundation","/api/badma"),t=this.axiosInstance.defaults.headers.common.Authorization,a=function(e){let s={};for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let a=e[t];if(null!=a)if("object"==typeof a)try{s[t]=JSON.stringify(a)}catch(e){B("Could not stringify object for key ".concat(t,":"),a)}else s[t]=String(a)}return s}(e);B("Sending GET request via injected Axios instance to ".concat(s," with params:"),a),B("Using Authorization header: ".concat(t||"none"));try{let e=await this.axiosInstance.get(s,{params:a,headers:{...t&&{Authorization:t}}});if(B("Received response from API (status ".concat(e.status,"):"),e.data),e.data&&(e.data.data||e.data.error))return e.data;return B("Error: Unexpected response format from API",e.data),{error:"Unexpected response format from server."}}catch(s){B("Axios GET request failed:",s);let e="Failed to communicate with the server.";if(E.A.isAxiosError(s)){if(e="Network or server error: ".concat(s.message),s.response){var l;e+=" (Status: ".concat(s.response.status,")"),B("Axios error response data:",s.response.data);let t=null==(l=s.response.data)?void 0:l.error;t&&(e="Server API Error: ".concat(t))}}else s instanceof Error&&(e=s.message);return{error:e}}}constructor(e){super(null),this.axiosInstance=e,B("AxiosChessClient initialized with provided Axios instance. Base URL: ".concat(this.axiosInstance.defaults.baseURL))}}var O=t(97418),L=t(54501),R=t(74001),z=t(12730),q=t(27172);function P(e){(0,q.useToastHandleError)(e,"Error loading games")}function G(e){(0,q.useToastHandleError)(e,"Error loading tournaments")}var H=t(59380),V=t(64183);let J=(0,U.A)("game");function W(e){let{gameData:s,gameInvite:t,onJoinInvite:r,isJoining:n}=e,i=(0,v.useHasyx)(),o=i.userId,{theme:c}=(0,L.useTheme)(),d=(0,j.useMemo)(()=>{if(!o)return J("No currentUserId provided, showing as spectator"),[];J("Looking for user joins with currentUserId:",o),J("Available joins:",s.joins.map(e=>({user_id:e.user_id,side:e.side,role:e.role})));let e=s.joins.filter(e=>e.user_id===i.userId&&1===e.role);return J("Found user joins:",e.length),e},[s.joins,o]),u=(0,j.useMemo)(()=>E.A.create({baseURL:"https://badma-dev.deep.foundation",headers:{"Content-Type":"application/json"}}),[]),m=(0,j.useMemo)(()=>{if(0===d.length||!o)return J("No chess clients created - spectator mode"),{};let e={};return d.forEach(t=>{let a=new F(u);a.clientId=t.client_id||t.id,a.userId=o,a.gameId=s.id,a.joinId=t.id,a.side=t.side,a.role=t.role,a.fen=s.fen,a.status=s.status;let l=new V.Qy("client");a.perks.registerPerk(l),J("Registered MinefieldPerk for client side:",t.side),e[t.side]=a,J("Created chess client for side:",t.side)}),J("Created chess clients for sides:",Object.keys(e)),e},[d,o,s,u]),x=(0,j.useMemo)(()=>{let e=s.joins.filter(e=>1===e.role).map(e=>e.user_id).filter((e,s,t)=>t.indexOf(e)===s);return J("All player user IDs:",e),e},[s.joins]),h=(0,j.useMemo)(()=>s.joins.filter(e=>1===e.role).map(e=>({id:e.user_id,color:1===e.side?"white":"black"})),[s.joins]);J("\uD83D\uDD0D [GAME] About to call useMultipleUserSettings with allUserIds:",x);let{settingsMap:p,loading:g,error:f}=(0,H.G7)(x);J("\uD83D\uDD0D [GAME] useMultipleUserSettings result:",{settingsMap:p,settingsLoading:g,settingsError:f});let{whitePiecesStyle:b,blackPiecesStyle:N}=(0,j.useMemo)(()=>{J("\uD83C\uDFA8 [PIECES_STYLE] Determining pieces styles for both players:",{currentUserId:o,settingsLoading:g,hasSettingsMap:!!p,settingsMapKeys:Object.keys(p||{}),players:null==h?void 0:h.map(e=>({id:e.id,color:e.color}))});let e=(0,R.Rq)("classic_pieces"),s=h.find(e=>"white"===e.color),t=h.find(e=>"black"===e.color),a=s?p[s.id]:null,l=(null==a?void 0:a.pieces)?a.pieces:"classic_pieces",r=(0,R.Rq)(l),n=t?p[t.id]:null,i=(null==n?void 0:n.pieces)?n.pieces:"classic_pieces",c=(0,R.Rq)(i);return J("\uD83C\uDFA8 [PIECES_STYLE] Player styles determined:",{whitePlayer:null==s?void 0:s.id,whitePlayerSettings:a,whiteStyleId:l,whiteStyleName:null==r?void 0:r.name,blackPlayer:null==t?void 0:t.id,blackPlayerSettings:n,blackStyleId:i,blackStyleName:null==c?void 0:c.name}),console.log("\uD83C\uDFA8 [PIECES_STYLE] DETAILED DEBUG:",{allPlayers:h,whitePlayer:s,blackPlayer:t,settingsMap:p,whitePlayerSettings:a,blackPlayerSettings:n,whiteStyleId:l,blackStyleId:i,whiteStyleResult:r,blackStyleResult:c}),{whitePiecesStyle:r||e,blackPiecesStyle:c||e}},[h,p,g]),w=(0,j.useMemo)(()=>0===d.length?"white":1===d.length?1===d[0].side?"white":"black":"white",[d]),y=(0,j.useMemo)(()=>{if(0===d.length)return console.log("\uD83D\uDD0D [WAITING] Spectator mode - not waiting"),!1;let e=s.joins.filter(e=>1===e.role),t="await"===s.status||1===e.length;return console.log("\uD83D\uDD0D [WAITING] Analysis:",{gameStatus:s.status,playerJoinsCount:e.length,userJoinsCount:d.length,isWaiting:t,allJoins:s.joins.map(e=>({user_id:e.user_id,side:e.side,role:e.role}))}),t},[d.length,s.status,s.joins]),_=(0,j.useMemo)(()=>{if("react"!==s.status&&"continue"!==s.status)return null;try{let e=new O.d;return e.fen=s.fen,e.turn}catch(e){return console.log("❌ [TURN] Error determining turn:",e),null}},[s.fen,s.status]),M=(0,j.useMemo)(()=>{if(0===d.length)return null;let e=new O.d;e.fen=s.fen;let t=e.turn;J("Determining active client:",{currentTurn:t,availableClients:Object.keys(m),gameDataFen:s.fen});let a=m[t];return a?(J("Active client found for turn ".concat(t,":"),a.clientId),a):(J("No active client for current turn ".concat(t)),null)},[m,s.fen,d.length]);J("Rendering game:",{gameId:s.id,fen:s.fen,status:s.status,userJoins:d.length,orientation:w,hasClients:Object.keys(m).length>0,isSpectator:0===d.length,isWaitingForOpponent:y});let[U,B]=(0,j.useState)(!0),[q,P]=(0,j.useState)(.8),[G,W]=(0,j.useState)(null),[K,Q]=(0,j.useState)({}),[Y,X]=(0,j.useState)(null),[Z,$]=(0,j.useState)(R.nO),ee=(0,C.d)(0),es=(0,C.d)(0),et=(0,A.s)(),ea=(0,j.useMemo)(()=>({minefield_perk:{x:ee,y:es,controls:et}}),[ee,es,et]),el=async()=>{if(!Y||!M)return void console.warn("Нет активного перка или клиента");let e=Z.find(e=>e.id===Y);if(!e||!e.perkClass)return void console.warn("Перк не найден или не имеет perkClass");try{let t=new e.perkClass("client");await t.handleApply(M,s.id),$(e=>e.filter(e=>e.id!==Y)),X(null),console.log("Перк ".concat(Y," успешно применен и удален из UI"))}catch(e){console.error("Ошибка при применении перка:",e)}};return(0,a.jsxs)("div",{className:"flex flex-col items-center w-full h-full min-h-screen relative",children:[t&&(0,a.jsx)("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,a.jsx)(z.j,{force:1.3,maxRotation:25,maxLift:50,useDeviceOrientation:!0,orientationSensitivity:.8,children:(0,a.jsx)("div",{className:"w-[400px] h-[400px] bg-purple-600 rounded-lg shadow-xl flex items-center justify-center pointer-events-none",children:(0,a.jsx)("div",{className:"text-white text-center pointer-events-auto p-8",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h1",{className:"text-4xl mb-4",children:"♟️"}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Приглашение в игру"}),(0,a.jsx)("p",{className:"text-sm opacity-80 mb-6",children:"Вас приглашают сыграть партию в шахматы"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(T.Button,{className:"w-full h-12 bg-white text-purple-600 hover:bg-gray-100 font-semibold",disabled:n,onClick:r,children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4 mr-2"}),"Присоединение..."]}):"Вступить в игру за ".concat(1===t.side?"белых":"черных")}),(0,a.jsx)(T.Button,{variant:"outline",className:"w-full h-10 border-white/30 text-white hover:bg-white/10",onClick:()=>window.history.back(),disabled:n,children:"Отменить"})]})]})})})})}),(0,a.jsx)("div",{className:"absolute top-16 w-full flex flex-col items-center",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[y&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Badge,{className:"bg-purple-900/90 text-white px-4 py-2 text-sm backdrop-blur-md shadow-lg",children:"Ожидание противника"}),(0,a.jsx)(T.Button,{size:"sm",variant:"outline",onClick:()=>{var e;let t=null==(e=d[0])?void 0:e.side,a="".concat(window.location.origin,"?gameId=").concat(s.id,"&side=").concat(1===t?2:1,"&role=1");navigator.clipboard.writeText(a).then(()=>{D.oR.success("Ссылка скопирована в буфер обмена!")}).catch(()=>{D.oR.error("Ошибка копирования ссылки")})},className:"text-xs",children:"Пригласить"})]}),_&&(0,a.jsxs)("div",{className:"px-4 py-2 text-sm rounded-lg border-2 ".concat(1===_?"bg-white border-black text-black":"bg-black border-white text-white"),children:["Ход ",1===_?"белых":"черных"]})]})}),(0,a.jsx)("div",{className:"absolute bottom-6 w-full flex flex-col items-center",children:(0,a.jsx)("div",{className:"flex items-center gap-3",children:0===d.length&&(0,a.jsx)(I.Badge,{variant:"outline",className:"px-4 py-2 text-sm border-2",children:"Режим наблюдателя"})})}),(0,a.jsx)("div",{className:"flex-1 w-full flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full h-full max-w-[min(80vw,80vh)] max-h-[min(80vw,80vh)] aspect-square relative",children:[(0,a.jsx)(k.A,{position:s.fen,onMove:d.length>0&&!y?e=>{console.log("\uD83C\uDFAF [MOVE] Move attempted:",e),J("handleMove attempted:",e);try{let t=new O.d;t.fen=s.fen;let a=t.turn;console.log("\uD83C\uDFAF [MOVE] Position loaded:",{originalFen:s.fen,loadedFen:t.fen,fenMatches:s.fen===t.fen}),console.log("\uD83C\uDFAF [MOVE] Turn analysis:",{currentTurn:a,availableClients:Object.keys(m),hasActiveClient:!!m[a],gameStatus:s.status,isWaitingForOpponent:y});let l=m[a];if(!l)return console.log("❌ [MOVE] No active client for current turn",a,"available clients:",Object.keys(m)),J("No active client for current turn",a,"available clients:",Object.keys(m)),!1;console.log("\uD83C\uDFAF [MOVE] Making move through client:",{clientId:l.clientId,userId:l.userId,side:l.side,gameId:l.gameId});let r=l.syncMove(e);if(r.error)return console.log("❌ [MOVE] Move error:",r.error),J("Move error:",r.error),!1;return console.log("✅ [MOVE] Move successful:",r),J("Move successful:",r),!0}catch(e){return console.log("❌ [MOVE] Error in handleMove:",e),J("Error in handleMove:",e),!1}}:void 0,orientation:w,bgBlack:"dark"===c?"#3b0764":"#c084fc",bgWhite:"dark"===c?"#581c87":"#dfbfff",whitePiecesStyle:b,blackPiecesStyle:N,animation:!0}),R.nO.map(e=>{let t=e.EffectComponent;return t?(0,a.jsx)(t,{gameData:s},"perk-effect-".concat(e.id)):null})]})}),M&&(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 flex justify-center items-end",style:{gap:"100px"},children:Z.map((e,s)=>{let t=ea[e.id];if(!t)return null;let{x:l,y:r,controls:n}=t,i=Y===e.id,o=null!==Y&&!i;return(0,a.jsx)("div",{className:"w-px h-px relative",children:(0,a.jsx)(S.P.div,{className:"absolute left-0 top-0 transform -translate-x-1/2 -translate-y-1/2 ".concat(o?"cursor-not-allowed opacity-50":i?"cursor-pointer":"cursor-grab active:cursor-grabbing"),drag:!o,dragElastic:.2,dragMomentum:!1,style:{x:l,y:r},animate:n,transition:{type:"spring",stiffness:300,damping:30},onClick:()=>{i&&el()},onDragEnd:async(s,t)=>{let a=window.innerHeight,l=r.get(),o=Math.abs(l)>.3*a;Math.abs(l)>.7*a&&i?await el():o&&!i?(X(e.id),await n.start({x:0,y:-a/2,transition:{type:"spring",stiffness:300,damping:30}})):i?Math.abs(l)<.3*a?(X(null),await n.start({x:0,y:0,transition:{type:"spring",stiffness:300,damping:30}})):await n.start({x:0,y:-a/2,transition:{type:"spring",stiffness:300,damping:30}}):await n.start({x:0,y:0,transition:{type:"spring",stiffness:300,damping:30}})},children:e.ItemComponent&&(0,a.jsx)(e.ItemComponent,{size:"small"})})},e.id)})})]})}function K(e){let{gameId:s,onClose:t,gameInvite:r,onJoinInvite:n,isJoining:i}=e;console.log("\uD83C\uDFAE [GAME] Game component rendered with props:",{gameId:s,hasGameInvite:!!r,gameInvite:r,hasOnJoinInvite:!!n,isJoining:i});let{data:o,loading:c,error:d}=(0,v.useSubscription)({table:"badma_games",where:{id:{_eq:s}},returning:["id","fen","status",{joins:["id","user_id","side","role","client_id"]},{perks:["id","type","game_id","user_id","data","created_at","applied_at"]}]},{skip:!s});console.log("\uD83C\uDFAE [GAME] Game data:",o);let u=(0,j.useMemo)(()=>{let e=Array.isArray(o)?o[0]:o&&o.badma_games?o.badma_games[0]:null;if(e){var s,t;console.log("Game data loaded:",{gameId:e.id,joinsCount:(null==(s=e.joins)?void 0:s.length)||0,joins:null==(t=e.joins)?void 0:t.map(e=>({user_id:e.user_id,side:e.side,role:e.role}))})}return e},[o]);return((0,q.useToastHandleError)(d,"Error loading game"),c)?(0,a.jsxs)("div",{className:"flex items-center justify-center h-full",children:[(0,a.jsx)(l.A,{className:"animate-spin h-8 w-8 text-purple-500"}),(0,a.jsx)("span",{className:"ml-2",children:"Loading game..."})]}):u?(0,a.jsx)(W,{gameData:u,gameInvite:r,onJoinInvite:n,isJoining:i}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Game not found"})})}function Q(e){let{onGameClick:s}=e,{theme:t}=(0,L.useTheme)(),r=(0,v.useHasyx)(),{data:n,loading:i}=(0,v.useSubscription)({table:"badma_games",where:{status:{_in:["continue","ready"]}},returning:["id","fen","status","updated_at",{joins:["id","user_id","side","role"]}],order_by:{created_at:"desc"},limit:15},{skip:!r.userId}),o=j.useMemo(()=>Array.isArray(n)?n:n&&n.badma_games?n.badma_games:[],[n]);return i?(0,a.jsxs)("div",{className:"h-[300px] flex items-center justify-center",children:[(0,a.jsx)(l.A,{className:"animate-spin h-6 w-6 text-purple-500 mr-2"}),(0,a.jsx)("span",{children:"Загрузка активных игр..."})]}):o.length?(0,a.jsxs)("div",{className:"h-[300px] w-full",children:[(0,a.jsxs)("h2",{className:"text-2xl font-semibold mb-4 text-center",children:["Активные игры ",(0,a.jsxs)("span",{className:"text-sm font-normal text-purple-500",children:["(",15==o.length?"15+":o.length,")"]})]}),(0,a.jsx)(w.FN,{className:"w-full mx-none",opts:{dragFree:!1,containScroll:"trimSnaps",watchDrag:(e,s)=>(s.stopPropagation(),!0)},children:(0,a.jsx)(w.Wk,{className:"",children:o.map(e=>(0,a.jsx)(w.A7,{className:"basis-[220px] flex-shrink-0",children:(0,a.jsx)("div",{className:"flex flex-col items-center relative p-1 cursor-pointer hover:bg-muted/30 rounded-lg transition-colors w-[220px] h-full",onClick:()=>null==s?void 0:s(e.id),onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:(0,a.jsx)("div",{className:"w-[200px] h-[200px] mb-2",children:(0,a.jsx)(k.A,{position:e.fen,onMove:void 0,orientation:1,bgBlack:"dark"===t?"#3b0764":"#c084fc",bgWhite:"dark"===t?"#581c87":"#dfbfff"})})})},e.id))})})]}):(0,a.jsx)("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"Нет активных игр"})}var Y=t(47631),X=t(40646),Z=t(14186),$=t(28883);let ee=e=>{let{userId:s,onGameClick:t}=e,[r,n]=j.useState("all"),i=j.useMemo(()=>{let e={table:"badma_joins",where:{user_id:{_eq:s},role:{_eq:1}},returning:["id","side","created_at",{game:["id","status","created_at","updated_at",{moves:["id"]}]}],order_by:{created_at:"desc"}};return"completed"===r?e.where={...e.where,game:{status:{_in:["finished","checkmate","stalemate","draw","white_surrender","black_surrender"]}}}:"active"===r?e.where={...e.where,game:{status:{_in:["ready","continue"]}}}:"invitations"===r&&(e.where={...e.where,game:{status:{_eq:"await"}}}),e},[s,r]),{data:o,loading:c,error:d}=(0,v.useSubscription)(i,{skip:!s});console.log("UserGames data:",o,"error:",d,"loading:",c,"userId:",s,"activeTab:",r);let u=j.useMemo(()=>Array.isArray(o)?o:o&&o.badma_joins?o.badma_joins:[],[o]);P(d);let m=()=>c?(0,a.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,a.jsx)(l.A,{className:"animate-spin h-6 w-6 text-purple-500 mr-2"}),"Loading games..."]}):u.length?(0,a.jsx)("div",{className:"space-y-2 p-1",children:u.map(e=>{var s,l;let r=e.game,n=(null==(s=r.moves)?void 0:s.length)||0,i=["finished","checkmate","stalemate","draw","white_surrender","black_surrender"].includes(r.status),o=["ready","continue"].includes(r.status),c="await"===r.status,d=1===e.side?"White":"Black";return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-muted/30 rounded-md cursor-pointer border border-muted/20",onClick:()=>t(r.id),children:[(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-foreground",children:["Game ID: ",r.id.substring(0,8),"..."]}),(0,a.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-muted rounded",children:d})]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[(0,a.jsxs)("span",{children:[n," moves"]}),r.created_at&&(0,a.jsxs)("span",{className:"ml-3",children:["Created: ",new Date(r.created_at).toLocaleDateString()]}),r.updated_at&&r.updated_at!==r.created_at&&(0,a.jsxs)("span",{className:"ml-3",children:["Updated: ",new Date(r.updated_at).toLocaleDateString()]})]})]}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full font-medium ".concat(i?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":o?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":c?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"),children:null!=(l=r.status)?l:"Unknown"})]},e.id)})}):(0,a.jsxs)("p",{className:"p-4 text-muted-foreground text-center",children:["all"===r&&"No games found.","completed"===r&&"No completed games found.","active"===r&&"No active games found.","invitations"===r&&"No pending invitations found."]});return(0,a.jsx)("div",{className:"w-full flex flex-col",children:(0,a.jsxs)(_.Tabs,{value:r,onValueChange:n,className:"w-full flex flex-col",children:[(0,a.jsx)("div",{className:"flex-none",children:(0,a.jsxs)(_.TabsList,{className:"grid w-full grid-cols-4",children:[(0,a.jsx)(_.TabsTrigger,{value:"all",className:"flex items-center",children:(0,a.jsx)(Y.A,{className:"h-4 w-4 mr-1"})}),(0,a.jsx)(_.TabsTrigger,{value:"completed",className:"flex items-center",children:(0,a.jsx)(X.A,{className:"h-4 w-4 mr-1"})}),(0,a.jsx)(_.TabsTrigger,{value:"active",className:"flex items-center",children:(0,a.jsx)(Z.A,{className:"h-4 w-4 mr-1"})}),(0,a.jsx)(_.TabsTrigger,{value:"invitations",className:"flex items-center",children:(0,a.jsx)($.A,{className:"h-4 w-4 mr-1"})})]})}),(0,a.jsxs)("div",{className:"flex-1 max-h-[400px]",children:[(0,a.jsx)(_.TabsContent,{value:"all",className:"pt-4",children:m()}),(0,a.jsx)(_.TabsContent,{value:"completed",className:"pt-4",children:m()}),(0,a.jsx)(_.TabsContent,{value:"active",className:"pt-4",children:m()}),(0,a.jsx)(_.TabsContent,{value:"invitations",className:"pt-4",children:m()})]})]})})};var es=t(51368);function et(e){let{currentUserId:s,onGameClick:t,children:r}=e,[n,i]=(0,j.useState)(!1),o=async()=>{if(!s)return void D.oR.error("User not authenticated");i(!0);try{var e;let a=E.A.create({baseURL:"https://badma-dev.deep.foundation",headers:{"Content-Type":"application/json"},withCredentials:!0}),l=new F(a);l.userId=s,l.clientId=(0,es.A)();let r=await l.asyncCreate(1);if(r.error)return void D.oR.error("Failed to create game: ".concat(r.error));if(null==(e=r.data)?void 0:e.gameId){let e=await l.asyncJoin(1,M.e.Player);if(e.error)return void D.oR.error("Failed to join game: ".concat(e.error));t(r.data.gameId),D.oR.success("Game created and joined successfully!")}else D.oR.error("Failed to create game: No game ID returned")}catch(e){console.error("Error creating game:",e),D.oR.error("Failed to create game: ".concat(e.message||"Unknown error"))}finally{i(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex flex-col items-center justify-start pt-4 overflow-y-auto h-full",children:(0,a.jsxs)("div",{className:"w-full space-y-8 flex flex-col items-center",children:[(0,a.jsx)("div",{className:"h-[250px] w-full",children:(0,a.jsx)(Q,{onGameClick:t})}),(0,a.jsxs)("div",{className:"flex flex-col items-center h-full w-full max-w-[1000px] px-4",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-4 text-center flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-6 w-6 text-purple-500"})," Мои игры",(0,a.jsx)(T.Button,{variant:"outline",size:"icon",className:"text-foreground flex flex-col items-center justify-center aspect-square",onClick:o,disabled:n,children:n?(0,a.jsx)(l.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(d.A,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)(ee,{userId:s,onGameClick:t})})})]})]})}),r]})}var ea=t(5716),el=t(25913),er=t(92648),en=t(42082),ei=t(76427),eo=t(32919),ec=t(10238),ed=t(5196),eu=t(80355);function em(e){let{show:s=!0,onComplete:t}=e,[l,r]=(0,j.useState)(s);return((0,j.useEffect)(()=>{if(s){r(!0);let e=setTimeout(()=>{r(!1),null==t||t()},3e3);return()=>clearTimeout(e)}},[s,t]),l)?(0,a.jsx)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:9999,pointerEvents:"none"},children:(0,a.jsx)(eu.A,{size:400,delay:0,repeatDelay:0,repeat:1})}):null}function ex(e){let{show:s=!0,onComplete:t}=e,[l,r]=(0,j.useState)(s);return(0,j.useEffect)(()=>{s&&r(!0)},[s]),l?(0,a.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-40deg) scale(1.5)",zIndex:0,pointerEvents:"none"},children:(0,a.jsx)(eu.A,{size:400,delay:0,repeatDelay:0,repeat:1,color:"#c084fc",onComplete:()=>{r(!1),null==t||t()}})}):null}function eh(e){var s;let{item:t,itemsStatus:l,onItemClick:r,onExplosionTrigger:n}=e,{getSetting:i}=(0,H.Qg)(),o=t.ItemComponent;return(0,a.jsx)(w.A7,{className:"basis-[250px] flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex flex-col items-center relative p-4 w-[250px]",onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o,{onClick:()=>{r(t),"owned"===l[t.id]&&n()},className:"mb-2"}),(e=>{switch(l[e]||"not_owned"){case"not_owned":return(0,a.jsxs)(I.Badge,{variant:"secondary",className:"absolute -top-2 -right-2 bg-gray-500 text-white text-xs px-2 py-1 z-10",children:[(0,a.jsx)(eo.A,{className:"w-3 h-3 mr-1"}),"Не в коллекции"]});case"owned":return(0,a.jsxs)(I.Badge,{variant:"secondary",className:"absolute -top-2 -right-2 bg-blue-500 text-white text-xs px-2 py-1 z-10",children:[(0,a.jsx)(ec.A,{className:"w-3 h-3 mr-1"}),"Получен"]});case"accepted":let s=i(t.category)===t.id;return(0,a.jsxs)(I.Badge,{variant:"secondary",className:"absolute -top-2 -right-2 text-white text-xs px-2 py-1 z-10 ".concat(s?"bg-purple-600":"bg-green-500"),children:[(0,a.jsx)(ed.A,{className:"w-3 h-3 mr-1"}),s?"Активен":"Принят"]});default:return null}})(t.id),(s=t.id,i(t.category)===s?(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-purple-500 rounded-lg pointer-events-none"}):null)]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground text-center max-w-48",children:t.description})]})})}function ep(e){let s,{children:t}=e,r=(0,v.useHasyx)(),[n,i]=j.useState(!0),[o,c]=j.useState(null),[d,u]=j.useState(!1),[m,x]=j.useState(!1),{settings:h,loading:p,getSetting:g,updateSetting:f}=(0,H.Qg)(),{data:b}=(0,v.useSubscription)({table:"badma_items",where:{user_id:{_eq:r.userId}},returning:["id","type","accepted","accepted_at"]},{skip:!r.userId}),N=j.useMemo(()=>{let e={};return R.Im.forEach(s=>{e[s.id]="not_owned"}),b&&b.forEach(s=>{s.accepted?e[s.type]="accepted":e[s.type]="owned"}),e},[b]),_=async()=>{if(o){u(!0);try{let e=o.category,s=o.id;f(e,s),await (0,ei.ZC)(r,e,s),c(null)}catch(e){console.error("Failed to apply setting:",e)}finally{u(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(em,{show:n,onComplete:()=>i(!1)}),(0,a.jsx)("div",{className:"flex flex-col items-center justify-start pt-4 overflow-y-auto h-full",children:(0,a.jsxs)("div",{className:"w-full max-w-4xl space-y-8 h-full",children:[(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Наборы фигур"}),(0,a.jsx)("div",{className:"h-[300px] w-full",children:(0,a.jsxs)(w.FN,{className:"w-full max-w-5xl mx-auto",opts:{dragFree:!1,containScroll:"trimSnaps",watchDrag:(e,s)=>(s.stopPropagation(),!0)},children:[(0,a.jsx)(w.Wk,{className:"-ml-2 md:-ml-4",children:R.Rm.map(e=>(0,a.jsx)(eh,{item:e,itemsStatus:N,onItemClick:c,onExplosionTrigger:()=>x(!0)},e.id))}),(0,a.jsx)(w.Q8,{className:"left-2"}),(0,a.jsx)(w.Oj,{className:"right-2"})]})})]}),(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Доски"}),(0,a.jsx)("div",{className:"h-[300px] w-full",children:(0,a.jsxs)(w.FN,{className:"w-full max-w-5xl mx-auto",opts:{dragFree:!1,containScroll:"trimSnaps",watchDrag:(e,s)=>(s.stopPropagation(),!0)},children:[(0,a.jsx)(w.Wk,{className:"-ml-2 md:-ml-4",children:R.QK.map(e=>(0,a.jsx)(eh,{item:e,itemsStatus:N,onItemClick:c,onExplosionTrigger:()=>x(!0)},e.id))}),(0,a.jsx)(w.Q8,{className:"left-2"}),(0,a.jsx)(w.Oj,{className:"right-2"})]})})]}),(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Перки"}),(0,a.jsx)("div",{className:"h-[300px] w-full",children:(0,a.jsxs)(w.FN,{className:"w-full max-w-5xl mx-auto",opts:{dragFree:!1,containScroll:"trimSnaps",watchDrag:(e,s)=>(s.stopPropagation(),!0)},children:[(0,a.jsx)(w.Wk,{className:"-ml-2 md:-ml-4",children:R.nO.map(e=>(0,a.jsx)(eh,{item:e,itemsStatus:N,onItemClick:c,onExplosionTrigger:()=>x(!0)},e.id))}),(0,a.jsx)(w.Q8,{className:"left-2"}),(0,a.jsx)(w.Oj,{className:"right-2"})]})})]})]})}),o&&(0,a.jsx)(y.Dialog,{open:!!o,onOpenChange:()=>{c(null),x(!1)},children:(0,a.jsx)(y.DialogContent,{className:"p-0 border-0 bg-transparent max-w-none w-auto",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,a.jsx)(ex,{show:m,onComplete:()=>x(!1)}),(0,a.jsx)(z.j,{force:1.5,maxRotation:25,maxLift:50,useDeviceOrientation:!0,orientationSensitivity:.8,children:(0,a.jsx)(o.ItemComponent,{size:"medium"})}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-4 text-center max-w-md",children:o.description}),(0,a.jsx)("div",{className:"mt-6",children:(s=o.id,g(null==o?void 0:o.category)===s)?(0,a.jsxs)(T.Button,{variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-50",disabled:!0,children:[(0,a.jsx)(X.A,{className:"w-4 h-4 mr-2"}),"Выбрано"]}):"not_owned"===N[o.id]?(0,a.jsxs)(T.Button,{variant:"outline",className:"border-gray-400 text-gray-500 bg-gray-100",disabled:!0,children:[(0,a.jsx)(eo.A,{className:"w-4 h-4 mr-2"}),"Не в коллекции"]}):"owned"===N[o.id]?(0,a.jsx)(T.Button,{onClick:async()=>{u(!0);try{let e=null==b?void 0:b.find(e=>e.type===o.id);e&&(await r.update({table:"badma_items",where:{id:{_eq:e.id}},_set:{accepted:!0,accepted_at:Date.now()}}),console.log("✅ [SKINS] Item accepted:",o.id)),c(null),x(!1)}catch(e){console.error("❌ [SKINS] Failed to accept item:",e)}finally{u(!1)}},disabled:d,className:"bg-green-600 hover:bg-green-700 text-white",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Принимаем..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.A,{className:"w-4 h-4 mr-2"}),"Принять"]})}):(0,a.jsx)(T.Button,{onClick:_,disabled:d,className:"bg-green-600 hover:bg-green-700 text-white",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Применяется..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ed.A,{className:"w-4 h-4 mr-2"}),"Выбрать"]})})})]})})}),t]})}var eg=t(72446);let ef=(0,t(65521).v)((e,s)=>({userClubs:[],isLoading:!1,error:null,setUserClubs:s=>e({userClubs:s}),setLoading:s=>e({isLoading:s}),setError:s=>e({error:s}),getUserClubById:e=>{let{userClubs:t}=s();return t.find(s=>s.id===e)}}));var ej=t(3072);let eb=["round-robin","swiss","knockout","scheveningen"],ev={"round-robin":"Round Robin - Each player plays against every other player",swiss:"Swiss System - Players paired based on performance",knockout:"Knockout/Olympic - Single elimination tournament",scheveningen:"Scheveningen System - Team vs team format"};var eN=t(27010),ew=t(72048);let ey=function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a='\n    <svg width="'.concat(100*t,'" height="').concat(100*t,'" viewBox="0 0 ').concat(100*t," ").concat(100*t,'" xmlns="http://www.w3.org/2000/svg">\n      <defs>\n        <pattern id="chess-pattern" x="0" y="0" width="').concat(25*t,'" height="').concat(25*t,'" patternUnits="userSpaceOnUse">\n          <rect x="0" y="0" width="').concat(12.5*t,'" height="').concat(12.5*t,'" fill="').concat(s,'"/>\n          <rect x="').concat(12.5*t,'" y="0" width="').concat(12.5*t,'" height="').concat(12.5*t,'" fill="').concat(e,'"/>\n          <rect x="0" y="').concat(12.5*t,'" width="').concat(12.5*t,'" height="').concat(12.5*t,'" fill="').concat(e,'"/>\n          <rect x="').concat(12.5*t,'" y="').concat(12.5*t,'" width="').concat(12.5*t,'" height="').concat(12.5*t,'" fill="').concat(s,'"/>\n        </pattern>\n      </defs>\n      <rect width="').concat(100*t,'" height="').concat(100*t,'" fill="url(#chess-pattern)"/>\n    </svg>\n  ');return"data:image/svg+xml;base64,".concat(btoa(a))},e_=(e,s)=>[{selector:"node",style:{"background-color":"var(--foreground)","background-opacity":0,shape:"circle",width:10,height:10,"border-radius":10,color:"var(--foreground)"}},{selector:"node.avatar",style:{"background-image":"data(image)","background-fit":"cover cover","background-opacity":1,width:10,height:10,shape:"circle","font-size":8,"border-color":"var(--color-purple-500)","border-width":1}},{selector:"edge",style:{width:2,"line-color":"var(--foreground)","target-arrow-color":"var(--foreground)","target-arrow-shape":"triangle","curve-style":"bezier"}}],ek=()=>{let e=(0,v.useHasyx)(),{theme:s}=(0,L.useTheme)(),l="dark"===s?"#3b0764":"#c084fc",r="dark"===s?"#581c87":"#dfbfff",[n,i]=(0,j.useState)(!1),o=(0,j.useMemo)(()=>e_(l,r),[l,r]),c=(0,j.useMemo)(()=>ey(l,r,1),[l,r]),d=(0,j.useCallback)(async s=>{t.g&&(t.g.cy=s),s.gridGuide({gridSpacing:12,drawGrid:!1}),await new Promise(e=>setTimeout(e,700)),s.elements().forEach(e=>{e.position({x:6,y:6})}),s.animate({fit:{eles:s.$("#"+e.userId),padding:100}})},[]),u=(0,j.useMemo)(()=>({name:"cola",nodeDimensionsIncludeLabels:!0,fit:!1}),[]);return(0,j.useEffect)(()=>{let e=setTimeout(()=>{i(!0)},2e3);return()=>clearTimeout(e)},[]),(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)("div",{className:"relative z-10 w-full h-full",children:(0,a.jsxs)(ew.Cyto,{onLoaded:d,buttons:!1,layout:u,zoomHandler:e=>2*e,style:{backgroundImage:'url("'.concat(c,'")')},children:[(0,a.jsx)(ew.CytoStyle,{stylesheet:o}),(0,a.jsx)(ew.CytoNode,{element:{id:e.userId,data:{id:e.userId,image:e.user.image,label:e.user.name},classes:"avatar"}})]})}),(0,a.jsx)("div",{className:"absolute bottom-20 pointer-events-none z-20 w-full",children:(0,a.jsxs)("div",{className:"text-center transition-opacity duration-1000 ".concat(n?"opacity-100":"opacity-0"),children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Chess Verse"}),(0,a.jsx)("h3",{className:"text-xl text-foreground",children:"coming soon ;)"})]})})]})};function eC(e){let{item:s,onAccept:t}=e,[r,n]=j.useState(!0),[i,o]=j.useState(!1),c=R.vr[s.type];if(!c)return null;let d=async()=>{o(!0);try{await t(s.id)}finally{o(!1)}};return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center gap-6",children:[(0,a.jsx)(ex,{show:r,onComplete:()=>n(!1)}),(0,a.jsx)(z.j,{force:1.3,maxRotation:25,maxLift:50,children:(0,a.jsx)(c,{size:"medium"})}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"Новый айтем получен!"}),(0,a.jsx)("p",{className:"text-sm text-white/80",children:s.definition.description})]}),(0,a.jsx)(T.Button,{onClick:d,disabled:i,className:"bg-green-600 hover:bg-green-700 text-white",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Принимаем..."]}):"Принять"})]})]})}function eA(e){let{children:s}=e,t=(0,v.useHasyx)(),[l,r]=j.useState([]),[n,i]=j.useState(!0),{data:o}=(0,v.useSubscription)({table:"badma_items",where:{user_id:{_eq:t.userId},accepted:{_eq:!1}},returning:["id","type","created_at"]},{skip:!t.userId}),c=j.useMemo(()=>{if(!o||0===o.length)return null;let e=[...o].sort((e,s)=>e.created_at-s.created_at).filter(e=>!l.includes(e.id));if(0===e.length)return null;let s=e[0],t=R.Im.find(e=>e.id===s.type);return t?{...s,definition:t}:null},[o,l]);j.useEffect(()=>{o&&0!==o.length||r([])},[o]);let d=async e=>{try{await t.update({table:"badma_items",where:{id:{_eq:e}},_set:{accepted:!0,accepted_at:Date.now()}}),r(s=>[...s,e]),console.log("✅ [CHECK_ITEMS] Item accepted:",e)}catch(e){console.error("❌ [CHECK_ITEMS] Failed to accept item:",e)}},u=null==c?void 0:c.id;return(0,a.jsxs)(a.Fragment,{children:[n&&c&&(0,a.jsx)(y.Dialog,{open:n,onOpenChange:e=>{if(i(e),!e&&o){let e=o.map(e=>e.id);r(s=>[...s,...e]),console.log("ℹ️ [CHECK_ITEMS] Dialog closed, skipping remaining items")}},children:(0,a.jsx)(y.DialogContent,{className:"p-0 border-0 bg-transparent max-w-none w-auto",children:(0,a.jsx)(eC,{item:c,onAccept:d},u)})}),(!n||!c)&&s]})}var eS=t(1035);function eI(e){let{isOpen:s,onClose:t,onSuccess:r}=e,n=(0,v.useHasyx)(),[i,o]=(0,j.useState)(!1),[c,d]=(0,j.useState)(""),u=async()=>{if(!n.userId)return void console.error("No user ID available");if(!c.trim())return void console.error("Club name is required");o(!0);try{await n.insert({table:"badma_clubs",object:{user_id:n.userId,title:c.trim()}}),console.log("✅ [CREATE_CLUB] Club created successfully"),d(""),r&&r(),t()}catch(e){console.error("❌ [CREATE_CLUB] Error creating club:",e)}finally{o(!1)}},m=()=>{d(""),t()};return(0,a.jsxs)(y.Dialog,{open:s,onOpenChange:e=>{e||m()},children:[(0,a.jsx)(y.DialogTitle,{}),(0,a.jsx)(y.DialogContent,{className:"max-w-sm",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Создать новый клуб"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Введите название для вашего клуба"})]}),(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)(eS.Input,{placeholder:"Название клуба",value:c,onChange:e=>d(e.target.value),disabled:i,className:"w-full",maxLength:50})}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)(T.Button,{variant:"outline",onClick:m,disabled:i,children:"Отмена"}),(0,a.jsx)(T.Button,{onClick:u,disabled:i||!c.trim(),className:"bg-yellow-500 hover:bg-yellow-600 text-white",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4 mr-2"}),"Создание..."]}):"Создать"})]})]})})]})}function eT(e){let{isOpen:s,onClose:t}=e,{data:r}=(0,f.useSession)();(0,v.useHasyx)();let{userClubs:n,isLoading:i}=ef(),[o,c]=(0,j.useState)(s),[d,u]=(0,j.useState)(!1),m=()=>{u(!0)};return j.useEffect(()=>{c(s)},[s]),j.useEffect(()=>{console.log("isCreateClubDialogOpen changed:",d)},[d]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(y.Dialog,{open:o,onOpenChange:e=>{c(e),e||t()},children:[(0,a.jsx)(y.DialogTitle,{}),(0,a.jsx)(y.DialogContent,{className:"p-0 border-0 bg-transparent max-w-none w-auto",children:(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-[300px] h-[500px] bg-purple-600 rounded-lg shadow-xl flex items-center justify-center pointer-events-none",children:(0,a.jsx)("div",{className:"text-white text-center pointer-events-auto",children:(0,a.jsxs)("div",{className:"space-y-2 text-xs opacity-60",children:[(0,a.jsx)("h1",{style:{fontSize:"4rem"},children:"\uD83E\uDEF6"}),(0,a.jsx)("p",{className:"text-xl",children:"Om Mani Badma Chess"}),(0,a.jsx)("p",{children:"Для игры вам нужно:"}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4",children:[(0,a.jsxs)(T.Button,{className:"h-[120px] w-[120px] bg-white flex flex-col items-center justify-center shadow-xl opacity-20",disabled:!0,children:[(0,a.jsx)("span",{className:"text-2xl mb-1",children:"\uD83E\uDD1D"}),(0,a.jsx)("span",{className:"text-xs",children:"Вступить в клуб"})]}),(0,a.jsxs)(T.Button,{className:"h-[120px] w-[120px] bg-white flex flex-col items-center justify-center shadow-xl",disabled:i,onClick:()=>{console.log("Create club button clicked!"),m()},children:[i?(0,a.jsx)(l.A,{className:"animate-spin h-6 w-6 mb-1"}):(0,a.jsx)("span",{className:"text-2xl mb-1",children:"➕"}),(0,a.jsx)("span",{className:"text-xs",children:i?"Загрузка...":"Создать клуб"})]})]})]})})})})})]}),(0,a.jsx)(eI,{isOpen:d,onClose:()=>{u(!1),c(!1),t()}})]})}var eD=t(84616);let eE=()=>{var e,s,t,r,n,i,o,d;let{data:u}=(0,f.useSession)(),m=(0,v.useHasyx)(),[x,h]=(0,j.useState)(""),[p,b]=(0,j.useState)(!1),[w,_]=(0,j.useState)(!1),[k,C]=(0,j.useState)(!1),[A,S]=(0,j.useState)(!1),[I,D]=(0,j.useState)(null),[E,M]=(0,j.useState)(!1),{data:U,loading:B,error:F}=(0,v.useSubscription)({table:"badma_clubs",where:{_or:[{user_id:{_eq:m.userId}},{in_clubs:{user_id:{_eq:m.userId}}}]},returning:["id","user_id","title","created_at","updated_at",{user:["id","name","image"]},{in_clubs:["id","user_id","status","created_by_id","created_at","updated_at",{user:["id","name","image"]},{created_by:["id","name","image"]}]}]},{skip:!m.userId});(0,q.useToastHandleError)(F,"Error loading club data");let O=j.useMemo(()=>U?Array.isArray(U)?U:U&&U.badma_clubs?U.badma_clubs:U:null,[U]),L=null==O?void 0:O[0];(0,j.useEffect)(()=>{(null==L?void 0:L.title)!==void 0&&h(L.title)},[null==L?void 0:L.title]);let R=x!==((null==L?void 0:L.title)||""),z=async()=>{if(L&&R){b(!0);try{await m.update({table:"badma_clubs",where:{id:{_eq:L.id}},_set:{title:x,updated_at:Date.now()}})}catch(e){console.error("Error saving club title:",e)}finally{b(!1)}}},P=async e=>{if(e){M(!0);try{await m.update({table:"badma_in_clubs",where:{id:{_eq:e.id}},_set:{status:"denied",updated_at:Date.now()}}),console.log("Member application rejected")}catch(e){console.error("Error rejecting member:",e)}finally{M(!1)}}},G=e=>{D(e),_(!0)},H=async()=>{if(I){M(!0);try{await m.update({table:"badma_in_clubs",where:{id:{_eq:I.id}},_set:{status:"approved",updated_at:Date.now()}}),console.log("Member application approved")}catch(e){console.error("Error approving member:",e)}finally{M(!1),_(!1),D(null)}}},V=e=>{D(e),C(!0)},J=async()=>{if(I){M(!0);try{await m.delete({table:"badma_in_clubs",where:{id:{_eq:I.id}}}),console.log("Member removed from club")}catch(e){console.error("Error removing member:",e)}finally{M(!1),C(!1),D(null)}}},W=()=>{S(!0)},K=async()=>{if(L&&m.userId){M(!0);try{if(L.user_id===m.userId)await m.update({table:"badma_clubs",where:{id:{_eq:L.id}},_set:{user_id:null,updated_at:Date.now()}}),console.log("Left club as owner - club is now ownerless");else{let e=Y.find(e=>e.user_id===m.userId);e&&(await m.delete({table:"badma_in_clubs",where:{id:{_eq:e.id}}}),console.log("Left club as member"))}}catch(e){console.error("Error leaving club:",e)}finally{M(!1),S(!1)}}};if(B)return(0,a.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,a.jsx)(l.A,{className:"animate-spin h-6 w-6 text-purple-500 mr-2"}),"Loading club data..."]});if(!L)return(0,a.jsxs)("div",{className:"p-4 text-center text-muted-foreground",children:[(0,a.jsx)("p",{children:"You are not a member of any club yet."}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"Join or create a club to see club information here."})]});let Q=L.user,Y=L.in_clubs||[],X=(null==Q?void 0:Q.id)===m.userId;return(0,a.jsxs)("div",{className:"space-y-4 p-1",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Club Title"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eS.Input,{value:x,onChange:e=>h(e.target.value),placeholder:"Enter club title...",disabled:p,className:"flex-1"}),R&&(0,a.jsx)(T.Button,{onClick:z,disabled:p,size:"sm",className:"flex items-center",children:p?(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4"}):(0,a.jsx)(ed.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Club Owner"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-md border-2 ".concat(X?"border-yellow-400 bg-yellow-50/20":"border-muted/20"),children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(N.Avatar,{className:"h-12 w-12",children:[(0,a.jsx)(N.AvatarImage,{src:null!=(n=null==Q?void 0:Q.image)?n:void 0,alt:null!=(i=null==Q?void 0:Q.name)?i:"Owner"}),(0,a.jsx)(N.AvatarFallback,{children:null!=(o=null==Q||null==(s=Q.name)||null==(e=s.charAt(0))?void 0:e.toUpperCase())?o:"O"})]}),(0,a.jsx)(c.A,{className:"absolute -top-1 -right-1 h-4 w-4 text-yellow-500 fill-yellow-500"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-foreground",children:null!=(d=null==Q?void 0:Q.name)?d:"Unknown Owner"}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Club ID: ",L.id.substring(0,8),"..."]})]}),X&&(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(T.Button,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 border-red-500 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:W,disabled:E,children:(0,a.jsx)(g.A,{className:"h-4 w-4"})})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:["Club Members (",Y.length,")"]}),(0,a.jsx)("div",{className:"space-y-2",children:Y.length>0?Y.map(e=>{var s,t,l,r,n,i;let o=e.user,d=(null==o?void 0:o.id)===(null==Q?void 0:Q.id);return(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-md border ".concat(d?"border-yellow-400 bg-yellow-50/20":"border-muted/20"),children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(N.Avatar,{className:"h-10 w-10",children:[(0,a.jsx)(N.AvatarImage,{src:null!=(l=null==o?void 0:o.image)?l:void 0,alt:null!=(r=null==o?void 0:o.name)?r:"Member"}),(0,a.jsx)(N.AvatarFallback,{children:null!=(n=null==o||null==(t=o.name)||null==(s=t.charAt(0))?void 0:s.toUpperCase())?n:"M"})]}),d&&(0,a.jsx)(c.A,{className:"absolute -top-1 -right-1 h-3 w-3 text-yellow-500 fill-yellow-500"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-foreground",children:null!=(i=null==o?void 0:o.name)?i:"Unknown Member"}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Status: ",(0,a.jsx)("span",{className:"font-medium ".concat("approved"===e.status?"text-green-600":"denied"===e.status?"text-red-600":"text-yellow-600"),children:e.status})]})]}),X&&"request"===e.status&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(T.Button,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 border-red-500 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:()=>P(e),disabled:E,children:(0,a.jsx)(g.A,{className:"h-4 w-4"})}),(0,a.jsx)(T.Button,{size:"sm",className:"h-8 w-8 p-0 bg-yellow-500 hover:bg-yellow-600 text-white",onClick:()=>G(e),disabled:E,children:(0,a.jsx)(eD.A,{className:"h-4 w-4"})})]}),L.user_id===m.userId&&"approved"===e.status&&!d&&(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(T.Button,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 border-red-500 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:()=>V(e),disabled:E,children:(0,a.jsx)(g.A,{className:"h-4 w-4"})})}),e.user_id===m.userId&&"approved"===e.status&&(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(T.Button,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 border-red-500 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:W,disabled:E,children:(0,a.jsx)(g.A,{className:"h-4 w-4"})})})]},e.id)}):(0,a.jsx)("div",{className:"text-center text-muted-foreground py-4",children:(0,a.jsx)("p",{className:"text-sm",children:"No members yet"})})})]}),(0,a.jsxs)("div",{className:"mt-6 p-3 bg-muted/20 rounded-md",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Club Information"}),(0,a.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Created:"}),(0,a.jsx)("span",{children:L.created_at?new Date(L.created_at).toLocaleDateString():"Unknown"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Last Updated:"}),(0,a.jsx)("span",{children:L.updated_at?new Date(L.updated_at).toLocaleDateString():"Unknown"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Total Members:"}),(0,a.jsx)("span",{children:Y.length+1})]})]})]}),(0,a.jsx)(y.Dialog,{open:w,onOpenChange:_,children:(0,a.jsxs)(y.DialogContent,{className:"max-w-md",children:[(0,a.jsxs)(y.DialogHeader,{children:[(0,a.jsxs)(y.DialogTitle,{children:["Вы точно хотите принять ",(null==I||null==(t=I.user)?void 0:t.name)||"этого пользователя"," в клуб?"]}),(0,a.jsx)(y.DialogDescription,{children:"После принятия пользователь станет полноправным членом клуба."})]}),(0,a.jsxs)(y.DialogFooter,{className:"flex gap-2",children:[(0,a.jsx)(T.Button,{variant:"outline",onClick:()=>_(!1),disabled:E,children:"Отмена"}),(0,a.jsx)(T.Button,{onClick:H,disabled:E,className:"bg-yellow-500 hover:bg-yellow-600 text-white",children:E?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4 mr-2"}),"Принятие..."]}):"Принять в клуб"})]})]})}),(0,a.jsx)(y.Dialog,{open:k,onOpenChange:C,children:(0,a.jsxs)(y.DialogContent,{className:"max-w-md",children:[(0,a.jsxs)(y.DialogHeader,{children:[(0,a.jsxs)(y.DialogTitle,{children:["Вы точно хотите удалить ",(null==I||null==(r=I.user)?void 0:r.name)||"этого пользователя"," из клуба?"]}),(0,a.jsx)(y.DialogDescription,{children:"После удаления пользователь перестанет быть членом клуба."})]}),(0,a.jsxs)(y.DialogFooter,{className:"flex gap-2",children:[(0,a.jsx)(T.Button,{variant:"outline",onClick:()=>C(!1),disabled:E,children:"Отмена"}),(0,a.jsx)(T.Button,{onClick:J,disabled:E,className:"bg-red-600 hover:bg-red-700 text-white",children:E?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4 mr-2"}),"Удаление..."]}):"Удалить из клуба"})]})]})}),(0,a.jsx)(y.Dialog,{open:A,onOpenChange:S,children:(0,a.jsxs)(y.DialogContent,{className:"max-w-md",children:[(0,a.jsxs)(y.DialogHeader,{children:[(0,a.jsx)(y.DialogTitle,{children:"Вы уверены, что хотите покинуть клуб?"}),(0,a.jsx)(y.DialogDescription,{children:(null==L?void 0:L.user_id)===m.userId?"Как владелец клуба, вы передадите управление клубом. Клуб станет бесхозным.":"Вы перестанете быть членом этого клуба."})]}),(0,a.jsxs)(y.DialogFooter,{className:"flex gap-2",children:[(0,a.jsx)(T.Button,{variant:"outline",onClick:()=>S(!1),disabled:E,children:"Отмена"}),(0,a.jsx)(T.Button,{onClick:K,disabled:E,className:"bg-red-600 hover:bg-red-700 text-white",children:E?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4 mr-2"}),"Выход..."]}):"Покинуть клуб"})]})]})})]})};var eM=t(76341),eU=t(12318);function eB(e){let{onNavigateToClubHall:s}=e,[t,r]=(0,j.useState)(null),[n,i]=(0,j.useState)(!1),[d,u]=(0,j.useState)(!1),[m,x]=(0,j.useState)(!1),[h,p]=(0,j.useState)(!1),{getUserClubById:g}=ef(),f=(0,v.useHasyx)(),{data:b,loading:w,error:_}=(0,v.useSubscription)({table:"badma_clubs",returning:["id","title","created_at",{user:["id","name","image"]}],order_by:{created_at:"desc"}}),k=j.useMemo(()=>Array.isArray(b)?b:b&&b.badma_clubs?b.badma_clubs:[],[b]);(0,q.useToastHandleError)(_,"Error loading clubs");let C=e=>{r(e),i(!0)},A=async()=>{if(t){u(!0);try{console.log("Challenging club:",t.id)}catch(e){console.error("Error challenging club:",e)}finally{u(!1),i(!1)}}},S=()=>{i(!1),x(!0)},I=async()=>{if(t&&f.userId){p(!0);try{await f.insert({table:"badma_in_clubs",object:{club_id:t.id,user_id:f.userId,created_by_id:f.userId,status:"request"}}),console.log("Application submitted successfully")}catch(e){console.error("Error submitting application:",e)}finally{p(!1),x(!1)}}};return w?(0,a.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,a.jsx)(l.A,{className:"animate-spin h-6 w-6 text-purple-500 mr-2"}),"Loading clubs..."]}):k.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"space-y-2 p-1",children:k.map(e=>{var s,t,l,r,n,i,c,d,u,m;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-muted/30 rounded-md cursor-pointer border border-muted/20",onClick:()=>C(e),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)(N.Avatar,{className:"h-8 w-8",children:[(0,a.jsx)(N.AvatarImage,{src:null!=(c=null==(s=e.user)?void 0:s.image)?c:void 0,alt:null!=(d=null==(t=e.user)?void 0:t.name)?d:"Club"}),(0,a.jsx)(N.AvatarFallback,{children:null!=(u=null==(n=e.user)||null==(r=n.name)||null==(l=r.charAt(0))?void 0:l.toUpperCase())?u:"C"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-foreground",children:e.title||"Untitled Club"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Created by ",null!=(m=null==(i=e.user)?void 0:i.name)?m:"Unknown"," • ",e.created_at&&new Date(e.created_at).toLocaleDateString()]})]})]}),(0,a.jsx)(o.A,{className:"h-4 w-4 text-muted-foreground"})]},e.id)})}),(0,a.jsxs)(y.Dialog,{open:n,onOpenChange:i,children:[(0,a.jsx)(y.DialogTitle,{}),(0,a.jsx)(y.DialogContent,{className:"p-0 border-0 bg-transparent max-w-none w-auto",children:(0,a.jsx)(z.j,{force:1.3,maxRotation:25,maxLift:50,useDeviceOrientation:!1,children:(0,a.jsx)("div",{className:"w-[300px] h-[400px] bg-background border-2 border-purple-500 rounded-lg shadow-xl flex flex-col items-center justify-center p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-6 text-foreground",children:(null==t?void 0:t.title)||"Untitled Club"}),(()=>{let e=t?g(t.id):null;return e&&e.id===(null==t?void 0:t.id)?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,a.jsx)("div",{className:"text-6xl mb-2",children:"\uD83C\uDF89"}),(0,a.jsx)("span",{className:"text-lg font-semibold text-purple-600",children:"Это наш клуб!"}),(0,a.jsxs)(T.Button,{className:"h-[60px] w-[200px] bg-purple-600 hover:bg-purple-700 text-white flex flex-col items-center justify-center shadow-xl mt-4",onClick:()=>{i(!1),null==s||s()},children:[(0,a.jsx)(c.A,{className:"h-5 w-5 mb-1"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Перейти в клуб-холл"})]})]}):(0,a.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,a.jsxs)(T.Button,{className:"h-[80px] w-[200px] bg-purple-600 hover:bg-purple-700 text-white flex flex-col items-center justify-center shadow-xl",disabled:d,onClick:A,children:[d?(0,a.jsx)(l.A,{className:"animate-spin h-5 w-5 mb-1"}):(0,a.jsx)(eM.A,{className:"h-5 w-5 mb-1"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:d?"Отправка...":"Бросить вызов"})]}),(0,a.jsxs)(T.Button,{variant:"outline",className:"h-[60px] w-[200px] border-purple-500 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 flex flex-col items-center justify-center",onClick:S,children:[(0,a.jsx)(eU.A,{className:"h-4 w-4 mb-1"}),(0,a.jsx)("span",{className:"text-xs",children:"Подать заявку"})]})]})})()]})})})})]}),(0,a.jsxs)(y.Dialog,{open:m,onOpenChange:x,children:[(0,a.jsx)(y.DialogTitle,{}),(0,a.jsxs)(y.DialogContent,{className:"max-w-md",children:[(0,a.jsxs)(y.DialogHeader,{children:[(0,a.jsx)(y.DialogTitle,{children:"Подать заявку на вступление в клуб?"}),(0,a.jsx)(y.DialogDescription,{children:"Если заявку примут - вы покинете клуб в котором находитесь."})]}),(0,a.jsxs)(y.DialogFooter,{className:"flex gap-2",children:[(0,a.jsx)(T.Button,{variant:"outline",onClick:()=>x(!1),disabled:h,children:"Отмена"}),(0,a.jsx)(T.Button,{onClick:I,disabled:h,className:"bg-purple-600 hover:bg-purple-700",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4 mr-2"}),"Отправка..."]}):"Подать заявку"})]})]})]})]}):(0,a.jsx)("p",{className:"p-4 text-muted-foreground",children:"No clubs found."})}var eF=t(26589),eO=t(53959),eL=t(34545),eR=t(14738),ez=t(34835);function eq(e){var s,t;let{isOpen:l,onClose:r,user:n,theme:i,setTheme:o,isLoadingSession:c,selectedBoardStyle:d,saveBoardStyleSetting:u,isSavingBoardStyle:m}=e;return(0,a.jsx)(y.Dialog,{open:l,onOpenChange:r,children:(0,a.jsxs)(y.DialogContent,{className:"max-w-md max-w-[90vw] w-full max-h-[90vh] p-0 gap-0",children:[(0,a.jsx)("div",{className:"flex justify-center -mt-20 relative z-10",children:(0,a.jsxs)(N.Avatar,{className:"border-4 border-background shadow-lg size-20 relative top-2 border-purple-500",children:[(0,a.jsx)(N.AvatarImage,{src:(null==n?void 0:n.image)||"",alt:(null==n?void 0:n.name)||"User",className:"z-1"}),(0,a.jsx)(N.AvatarFallback,{className:"text-lg font-semibold",children:(null==n||null==(t=n.name)||null==(s=t.charAt(0))?void 0:s.toUpperCase())||"U"})]})}),(0,a.jsx)(eO.Card,{className:"border-0 shadow-none",children:(0,a.jsxs)(_.Tabs,{defaultValue:"account",className:"w-full h-full flex flex-col",children:[(0,a.jsx)("div",{className:"px-6 pb-2",children:(0,a.jsxs)(_.TabsList,{className:"w-full",children:[(0,a.jsx)(_.TabsTrigger,{value:"account",children:"Account"}),(0,a.jsx)(_.TabsTrigger,{value:"accounts",children:"Accounts"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 pb-2",children:[(0,a.jsxs)(_.TabsContent,{value:"account",className:"h-full flex flex-col space-y-4 mt-0",children:[(0,a.jsxs)("div",{className:"flex-grow space-y-4",children:[(0,a.jsxs)("div",{className:"text-center space-y-1",children:[(0,a.jsx)("p",{className:"font-medium",children:(null==n?void 0:n.name)||"N/A"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==n?void 0:n.email)||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eL.Label,{className:"block text-sm font-medium mb-3",children:"Тема"}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>o("system"),className:"w-12 h-12 rounded-full border-2 flex items-center justify-center transition-all ".concat("system"===i?"border-purple-500 bg-transparent":"border-border hover:border-purple-300"),children:(0,a.jsx)(eR.A,{className:"w-5 h-5 text-foreground"})}),(0,a.jsx)("button",{onClick:()=>o("light"),className:"w-12 h-12 rounded-full border-2 flex items-center justify-center transition-all ".concat("light"===i?"border-purple-500 bg-white":"border-border bg-white hover:border-purple-300")}),(0,a.jsx)("button",{onClick:()=>o("dark"),className:"w-12 h-12 rounded-full border-2 flex items-center justify-center transition-all ".concat("dark"===i?"border-purple-500 bg-black":"border-border bg-black hover:border-purple-300")})]})]})]}),(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsxs)(T.Button,{variant:"outline",className:"w-full",onClick:()=>(0,f.signOut)({callbackUrl:"/"}),disabled:c,children:[(0,a.jsx)(ez.A,{className:"mr-2 h-4 w-4"})," Sign Out"]})})]}),(0,a.jsx)(_.TabsContent,{value:"accounts",className:"mt-0 h-full",children:(0,a.jsx)("div",{className:"h-full overflow-y-auto",children:(0,a.jsx)(eF.Accounts,{})})})]})]})})]})})}let eP=e=>{switch(e){case"await":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-200";case"ready":return"bg-blue-100 text-blue-800 dark:bg-blue-700 dark:text-blue-200";case"continue":return"bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-200";default:return"bg-gray-100 text-gray-600 dark:bg-gray-600 dark:text-gray-300"}},eG=e=>{let{tournamentId:s}=e,{data:t,loading:r,error:n}=(0,v.useSubscription)({table:"badma_tournament_participants",where:{tournament_id:{_eq:s},role:{_eq:1}},returning:["id","user_id",{user:["id","name","image"]},{scores_aggregate:{aggregate:{sum:["score"]}}}]},{skip:!s,role:"user"}),{data:i}=(0,v.useSubscription)({table:"badma_joins",where:{role:{_eq:1},game:{tournament_games:{tournament_id:{_eq:s}}}},returning:["id","user_id",{game:["id","status",{moves:["id"]}]}]},{skip:!s}),o=j.useMemo(()=>Array.isArray(t)?t:t&&t.badma_tournament_participants?t.badma_tournament_participants:[],[t]),c=j.useMemo(()=>{let e=Array.isArray(i)?i:(null==i?void 0:i.badma_joins)||[],s={};return e.forEach(e=>{s[e.user_id]||(s[e.user_id]=[]),s[e.user_id].push(e.game)}),s},[i]);return((0,q.useToastHandleError)(n,"Error loading participants"),r)?(0,a.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,a.jsx)(l.A,{className:"animate-spin h-6 w-6 text-purple-500 mr-2"})," Loading participants..."]}):o.length?(0,a.jsx)("div",{className:"space-y-4 p-1",children:o.map(e=>{var s,t,l,r,n,i,o,d,u,m,x,h,p;let g=(null==(l=e.scores_aggregate)||null==(t=l.aggregate)||null==(s=t.sum)?void 0:s.score)||0,f=c[e.user_id]||[];return(0,a.jsxs)("div",{className:"p-3 hover:bg-muted/30 rounded-md border border-muted/20",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsxs)(N.Avatar,{className:"h-8 w-8",children:[(0,a.jsx)(N.AvatarImage,{src:null!=(m=null==(r=e.user)?void 0:r.image)?m:void 0,alt:null!=(x=null==(n=e.user)?void 0:n.name)?x:"User"}),(0,a.jsx)(N.AvatarFallback,{children:null!=(h=null==(d=e.user)||null==(o=d.name)||null==(i=o.charAt(0))?void 0:i.toUpperCase())?h:"U"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-foreground",children:null!=(p=null==(u=e.user)?void 0:u.name)?p:"Anonymous User"}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Total Score: ",(0,a.jsx)("span",{className:"font-medium text-green-600",children:g})]})]})]}),f.length>0&&(0,a.jsxs)("div",{className:"ml-11 space-y-1",children:[(0,a.jsxs)("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:["Games (",f.length,"):"]}),f.map(e=>{var s,t;return(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs bg-muted/30 rounded px-2 py-1 cursor-pointer hover:bg-muted/50 transition-colors",onClick:s=>{s.stopPropagation(),eH(e.id)},children:[(0,a.jsxs)("span",{className:"font-mono",children:[e.id.substring(0,8),"..."]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("span",{className:"text-muted-foreground",children:[(null==(s=e.moves)?void 0:s.length)||0," moves"]}),(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium ".concat("finished"===e.status||"checkmate"===e.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"),children:null!=(t=e.status)?t:"Unknown"})]})]},e.id)})]})]},e.id)})}):(0,a.jsx)("p",{className:"p-4 text-muted-foreground",children:"No active participants found for this tournament."})},eH=()=>{},eV=e=>{let{tournamentId:s}=e,{data:t,loading:r,error:n}=(0,v.useSubscription)({table:"badma_tournament_games",where:{tournament_id:{_eq:s}},returning:["id",{game:["id","status",{moves:["id"]}]}]},{skip:!s}),i=j.useMemo(()=>Array.isArray(t)?t:t&&t.badma_tournament_games?t.badma_tournament_games:[],[t]);return(P(n),r)?(0,a.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,a.jsx)(l.A,{className:"animate-spin h-6 w-6 text-purple-500 mr-2"})," Loading games..."]}):i.length?(0,a.jsx)("div",{className:"space-y-2 p-1",children:i.map(e=>{var s,t;let l=(null==(s=e.game.moves)?void 0:s.length)||0;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-muted/30 rounded-md cursor-pointer border border-muted/20",onClick:()=>eH(e.game.id),children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-foreground",children:["Game ID: ",e.game.id.substring(0,8),"..."]}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[l," moves played"]})]}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full font-medium ".concat("finished"===e.game.status||"checkmate"===e.game.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":e.game.status?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-gray-100 text-gray-600 dark:bg-gray-600 dark:text-gray-300"),children:null!=(t=e.game.status)?t:"Unknown"})]},e.id)})}):(0,a.jsx)("p",{className:"p-4 text-muted-foreground",children:"No games found for this tournament."})},eJ=e=>{let{userId:s}=e,{data:t,loading:r,error:n}=(0,v.useSubscription)({table:"badma_tournament_participants",where:{user_id:{_eq:s},role:{_eq:1}},returning:["id",{tournament:["id","type","status","created_at"]},{scores_aggregate:{aggregate:{sum:["score"]}}}],order_by:{created_at:"desc"}},{skip:!s}),{data:i}=(0,v.useSubscription)({table:"badma_tournament_scores",returning:["tournament_id","participant_id","score"]}),o=j.useMemo(()=>Array.isArray(t)?t:t&&t.badma_tournament_participants?t.badma_tournament_participants:[],[t]),c=j.useMemo(()=>{let e=Array.isArray(i)?i:(null==i?void 0:i.badma_tournament_scores)||[],s={};return e.forEach(e=>{let t=e.tournament_id;(!s[t]||e.score>s[t])&&(s[t]=e.score)}),s},[i]);return(G(n),r)?(0,a.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,a.jsx)(l.A,{className:"animate-spin h-6 w-6 text-purple-500 mr-2"})," Loading tournaments..."]}):o.length?(0,a.jsx)("div",{className:"space-y-2 p-1",children:o.map(e=>{var s,t,l;let r=e.tournament,n=(null==(l=e.scores_aggregate)||null==(t=l.aggregate)||null==(s=t.sum)?void 0:s.score)||0,i=c[r.id]||0;return(0,a.jsx)("div",{className:"p-3 hover:bg-muted/30 rounded-md border border-muted/20",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-foreground",children:r.type}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["ID: ",r.id.substring(0,8),"..."]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["Score: ",(0,a.jsx)("span",{className:"font-medium text-green-600",children:n}),i>0&&(0,a.jsxs)("span",{children:[" / ",(0,a.jsx)("span",{className:"text-yellow-600",children:i})," max"]}),r.created_at&&(0,a.jsxs)("span",{className:"ml-3",children:["Created: ",new Date(r.created_at).toLocaleDateString()]})]})]}),(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium ".concat(eP(r.status)),children:r.status.charAt(0).toUpperCase()+r.status.slice(1)})]})},e.id)})}):(0,a.jsx)("p",{className:"p-4 text-muted-foreground",children:"No tournaments found."})};function eW(){var e,s,t,k,C;let{data:A,status:S}=(0,f.useSession)(),M=null==A?void 0:A.user,{theme:U,setTheme:B}=(0,L.useTheme)(),O=(0,v.useHasyx)(),R=async e=>{if(O.userId){si(!0);try{await O.insert({table:"badma_settings",object:{user_id:O.userId,key:"board",value:e},on_conflict:{constraint:"settings_user_key_unique",update_columns:["value"]}}),D.oR.success("Настройки доски сохранены")}catch(e){console.error("Error saving board style setting:",e),D.oR.error("Ошибка при сохранении настроек доски")}finally{si(!1)}}},z=(0,eg.sn)(!0),q=(0,eg.mu)(!0),{data:P,loading:H}=(0,v.useSubscription)({table:"users",where:{id:{_eq:O.userId}},returning:["id","name","image"],limit:1},{skip:!O.userId}),{data:V,loading:J,error:W}=(0,v.useSubscription)({table:"badma_clubs",where:{_or:[{user_id:{_eq:O.userId}},{in_clubs:{user_id:{_eq:O.userId}}}]},returning:["id","user_id","title","created_at","updated_at",{user:["id","name","image"]},{in_clubs:["id","user_id","status","created_by_id","created_at","updated_at",{user:["id","name","image"]},{created_by:["id","name","image"]}]}]},{skip:!O.userId}),{data:Q}=(0,v.useSubscription)({table:"badma_settings",where:{user_id:{_eq:O.userId}},returning:["id","key","value"]},{skip:!O.userId}),{setUserClubs:Y,setLoading:X,setError:Z}=ef(),{setSettings:$,getSetting:ee,setLoading:ei,setError:eo}=(0,ej.Z)();j.useEffect(()=>{Q&&($(Q),sr(ee("board")))},[Q,$,ee]);let ec=j.useMemo(()=>{let e;return V?((e=Array.isArray(V)?V:V&&V.badma_clubs?V.badma_clubs:V)&&Array.isArray(e)&&Y(e),e):null},[V,Y]);j.useEffect(()=>{X(J),Z(W?(null==W?void 0:W.message)||"Unknown error":null)},[J,W,X,Z]);let ed=O.userId,[eu,em]=(0,j.useState)(),ex=j.useMemo(()=>["profile","tournaments","skins","games"],[]),[eh,ew]=(0,j.useState)(ex[1]),[ey,e_]=(0,j.useState)("tournaments"),[eC,eS]=(0,j.useState)(!1),[eD,eM]=(0,j.useState)(null),[eU,eF]=(0,j.useState)(!1),[eO,eR]=(0,j.useState)(!1),[ez,eW]=(0,j.useState)("round-robin"),[eK,eQ]=(0,j.useState)(!1),[eY,eX]=(0,j.useState)(!1),[eZ,e$]=(0,j.useState)(!1),[e0,e1]=(0,j.useState)(null),[e2,e4]=(0,j.useState)(!1),[e5,e3]=(0,j.useState)(!1),[e6,e8]=(0,j.useState)(!1),[e9,e7]=(0,j.useState)(null),[se,ss]=(0,j.useState)(null),[st,sa]=(0,j.useState)(!1),[sl,sr]=(0,j.useState)("classic_board"),[sn,si]=(0,j.useState)(!1),so="authenticated"===S,sc="loading"===S;(0,j.useEffect)(()=>{let e=new URLSearchParams(window.location.search),s=e.get("gameId"),t=e.get("side"),a=e.get("role");if(console.log("\uD83D\uDD0D [INVITE] URL params:",{gameId:s,side:t,role:a,fullUrl:window.location.href}),s&&t&&a){console.log("✅ [INVITE] Valid invite parameters found, clearing URL and saving to pendingInvite"),window.history.replaceState({},document.title,window.location.pathname);let e={gameId:s,side:parseInt(t),role:parseInt(a)};console.log("\uD83D\uDCBE [INVITE] Saving pending invite:",e),ss(e)}else console.log("❌ [INVITE] No valid invite parameters found")},[]),(0,j.useEffect)(()=>so?ed?se?void(console.log("✅ [INVITE] All conditions met, processing pending invite:",se),console.log("\uD83D\uDD04 [INVITE] Moving pending invite to active gameInvite"),e7(se),ss(null),console.log("\uD83C\uDFAE [INVITE] Opening game for preview:",se.gameId),sd(se.gameId)):void console.log("\uD83D\uDEA8 [INVITE] No pending invite to process"):void console.log("⏳ [INVITE] Waiting for currentUserId..."):void console.log("⏳ [INVITE] Waiting for authentication..."),[so,ed,se]);let sd=e=>{console.log("\uD83D\uDD13 [OPEN_GAME] Opening game:",e),e1(e),eC&&eS(!1),console.log("\uD83D\uDD13 [OPEN_GAME] Game opened, selectedGameId set to:",e)};(0,j.useEffect)(()=>{eH=sd},[eC,sd]);let su=()=>{e1(null),e7(null)},sm=async()=>{if(console.log("\uD83C\uDFAE handleJoinGameFromInvite called with:",{gameInvite:e9,currentUserId:ed,session:A}),!e9||!ed||!A)return void console.log("❌ Missing gameInvite, currentUserId, or session");try{let e=await (0,f.getSession)();console.log("\uD83D\uDD11 Fresh session exists:",!!e);let s=E.A.create({baseURL:"https://badma-dev.deep.foundation",headers:{"Content-Type":"application/json"},withCredentials:!0});console.log("\uD83C\uDF6A Using cookie-based authentication like handleCreateGame");let t=(0,es.A)(),a=new F(s);a.clientId=t,a.userId=ed,a.gameId=e9.gameId,console.log("\uD83D\uDE80 Attempting to join game with:",{gameId:e9.gameId,side:e9.side,role:e9.role,clientId:a.clientId,userId:a.userId});let l=await a.asyncJoin(e9.side,e9.role);if(console.log("\uD83C\uDFAF Join response:",l),l.error){console.error("❌ Join failed:",l.error),D.oR.error("Failed to join game: ".concat(l.error));return}e7(null),D.oR.success("Successfully joined the game!")}catch(e){console.error("Failed to join game from invite:",e),D.oR.error("Failed to join game: ".concat(e.message||"Unknown error"))}},sx=e=>{eM(e),eF(!0)},{data:sh,loading:sp,error:sg}=(0,v.useSubscription)({table:"badma_tournaments",returning:["id","user_id","status","type","created_at",{tournament_games:["id",{game:["id","status"]}]},{participants:["id","user_id","role"]}],order_by:{created_at:"desc"}},{skip:!so}),sf=j.useMemo(()=>Array.isArray(sh)?sh:sh&&sh.badma_tournaments?sh.badma_tournaments:sh&&sh.tournaments?sh.tournaments:[],[sh]);G(sg),(0,j.useEffect)(()=>{if(!eu)return;let e=ex.indexOf(eh);-1!==e&&e!==eu.selectedScrollSnap()&&eu.scrollTo(e);let s=()=>{let e=eu.selectedScrollSnap();ex[e]!==eh&&ew(ex[e])};return eu.on("select",s),()=>{eu&&eu.off("select",s)}},[eu,eh,ex]);let sj=async()=>{if(ed){eQ(!0);try{let e=await O.insert({table:"badma_tournaments",object:{user_id:ed,status:"await",type:ez},returning:["id","status","type","created_at","user_id"]});eR(!1),eM(e),eF(!0),eW("round-robin")}catch(e){console.error("Error creating tournament:",e)}finally{eQ(!1)}}},sb=async()=>{if(eD){eX(!0);try{await E.A.post("/api/badma/tournament-ai",null,{params:{id:eD.id}})}catch(e){console.error("Error adding AI players:",e)}finally{eX(!1)}}},sv=async()=>{if(eD){e$(!0);try{(await E.A.post("/api/badma/tournament-start",null,{params:{id:eD.id}})).data.success&&D.oR.success("Tournament Started")}catch(e){console.error("Error starting tournament:",e),D.oR.error("Failed to Start Tournament")}finally{e$(!1)}}};return((0,j.useEffect)(()=>{if(z.needsUserInteraction||q.needsUserInteraction){e4(!0);let e=setTimeout(()=>{e4(!1)},5e3);return()=>clearTimeout(e)}},[z.needsUserInteraction,q.needsUserInteraction]),sc)?(0,a.jsx)("div",{className:"flex flex-1 flex-col bg-background items-center justify-center h-screen",children:(0,a.jsx)(l.A,{className:"animate-spin h-12 w-12 text-purple-500"})}):so?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed -top-3 left-0 z-[9999] w-full flex justify-center",children:(0,a.jsxs)("div",{className:"flex w-full",children:[(0,a.jsxs)("div",{className:"w-full px-2 relative",children:[(0,a.jsx)(en.k,{value:30,className:"bg-purple-500/30 h-6",indicator:{className:"bg-purple-500"}}),(0,a.jsx)("div",{className:"bg-purple-500 p-1 rounded-full absolute top-3 left-0 color-foreground shadow-md",style:{borderTopLeftRadius:0},children:(0,a.jsx)(r.A,{})})]}),(0,a.jsx)("div",{className:"flex-shrink-0 relative",children:(0,a.jsx)("div",{className:(0,eN.cn)("bg-background p-2 rounded-full absolute top-3 left-1/2 transform -translate-x-1/2 color-foreground shadow-md z-10 cursor-pointer hover:bg-purple-500 transition-all scale-150 border-3 border-purple-500",{"scale-200":st}),onClick:()=>sa(!st),children:(0,a.jsx)(n.A,{className:"h-4 w-4 md:h-5 md:w-5"})})}),(0,a.jsxs)("div",{className:"w-full px-2 relative",children:[(0,a.jsx)(en.k,{value:30,className:"bg-yellow-500/30 rotate-180 h-6",indicator:{className:"bg-yellow-500"}}),(0,a.jsx)("div",{className:"bg-yellow-500 p-1 rounded-full absolute top-3 right-0 color-foreground shadow-md",style:{borderTopRightRadius:0},children:(0,a.jsx)(i.A,{})})]})]})}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col bg-background relative h-screen max-h-screen overflow-hidden",children:[(0,a.jsx)(w.FN,{setApi:em,opts:{align:"start",loop:!1},className:"flex-grow flex flex-col pt-0 pb-14 h-full",children:(0,a.jsxs)(w.Wk,{className:"h-full",root:{className:"h-full"},children:[(0,a.jsx)(w.A7,{className:"h-full overflow-y-auto pt-10",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-start h-full p-4 text-center overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,a.jsxs)(N.Avatar,{className:"h-24 w-24 mb-4",children:[(0,a.jsx)(N.AvatarImage,{src:null!=(t=null==M?void 0:M.image)?t:void 0,alt:null!=(k=null==M?void 0:M.name)?k:"User"}),(0,a.jsx)(N.AvatarFallback,{className:"text-2xl",children:null!=(C=null==M||null==(s=M.name)||null==(e=s.charAt(0))?void 0:e.toUpperCase())?C:"U"})]}),(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-1",children:(null==M?void 0:M.name)||((null==M?void 0:M.email)?M.email.substring(0,8)+"...":"Anonymous")}),(null==M?void 0:M.email)&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:M.email})]}),(0,a.jsx)("div",{className:"w-full max-w-2xl",children:(0,a.jsxs)(_.Tabs,{value:ey,onValueChange:e_,className:"w-full",children:[(0,a.jsxs)(_.TabsList,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(_.TabsTrigger,{value:"tournaments",className:"flex items-center",children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Tournaments"]}),(0,a.jsxs)(_.TabsTrigger,{value:"club",className:"flex items-center",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Club"]})]}),(0,a.jsx)(_.TabsContent,{value:"tournaments",className:"pt-4",children:ed&&(0,a.jsx)(eJ,{userId:ed})}),(0,a.jsx)(_.TabsContent,{value:"club",className:"pt-4",children:(0,a.jsx)(eE,{})})]})})]})},"profile"),(0,a.jsx)(w.A7,{className:"h-full overflow-y-auto pt-10",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-start h-full p-4 text-center overflow-y-auto",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.A,{className:"h-10 w-10 mr-3 text-purple-500"}),(0,a.jsx)("h2",{className:"text-3xl font-semibold",children:"Rating"})]})}),(0,a.jsx)("div",{className:"w-full max-w-2xl",children:(0,a.jsxs)(_.Tabs,{defaultValue:"clubs",className:"w-full",children:[(0,a.jsxs)(_.TabsList,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(_.TabsTrigger,{value:"clubs",className:"flex items-center",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Clubs"]}),(0,a.jsxs)(_.TabsTrigger,{value:"tournaments",className:"flex items-center",children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Tournaments"]})]}),(0,a.jsxs)(_.TabsContent,{value:"clubs",className:"pt-4",children:[(0,a.jsxs)(T.Button,{variant:"outline",className:"w-full mb-4 border-purple-500 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20",onClick:()=>{console.log("\uD83D\uDD18 [CREATE_CLUB] Button clicked"),e8(!0)},children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Создать клуб"]}),(0,a.jsx)(eB,{onNavigateToClubHall:()=>{ew("profile"),e_("club")}})]}),(0,a.jsxs)(_.TabsContent,{value:"tournaments",className:"pt-4",children:[(0,a.jsxs)(T.Button,{variant:"outline",className:"w-full mb-4 border-purple-500 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20",onClick:()=>eR(!0),children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Создать турнир"]}),sp&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(l.A,{className:"animate-spin h-5 w-5"})," ",(0,a.jsx)("p",{children:"Loading tournaments..."})]}),!sp&&sf.length>0?(0,a.jsx)("div",{className:"w-full max-w-2xl space-y-1",children:sf.map(e=>{let s=e.tournament_games||[],t=s.length,l=s.filter(e=>e.game&&["finished","checkmate","stalemate","draw","white_surrender","black_surrender"].includes(e.game.status||"")).length,r=(e.participants||[]).filter(e=>1===e.role).length;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-muted/50 dark:hover:bg-muted/20 rounded-md cursor-pointer transition-colors border border-muted/20",onClick:()=>sx(e),children:[(0,a.jsxs)("div",{className:"flex flex-col flex-1 items-start pr-3 min-w-0",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-foreground truncate",children:e.type}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground truncate",children:["ID: ",e.id.substring(0,8),"..."]})]}),(0,a.jsxs)("div",{className:"flex flex-col flex-1 items-center flex-shrink-0 px-3 min-w-0",children:[(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Games: ",(0,a.jsx)("span",{className:"text-green-600 font-medium",children:l}),"/",t]}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Players: ",(0,a.jsx)("span",{className:"font-medium",children:r})]})]}),(0,a.jsxs)("div",{className:"flex flex-col flex-1 items-end flex-shrink-0 space-y-1 min-w-0",children:[(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium ".concat(eP(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),e.created_at&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})}):!sp&&(0,a.jsx)("p",{children:"No tournaments found."})]})]})})]})},"tournaments"),(0,a.jsx)(w.A7,{className:"h-full overflow-y-auto pt-10",children:"skins"===eh&&(0,a.jsx)(ep,{})},"skins"),(0,a.jsx)(w.A7,{className:"h-full overflow-y-auto pt-10",children:"games"===eh&&ed&&(0,a.jsx)(et,{currentUserId:ed,onGameClick:eH})},"games")]})}),eD&&(0,a.jsx)(y.Dialog,{open:eU,onOpenChange:eF,children:(0,a.jsxs)(y.DialogContent,{className:"sm:max-w-[600px] h-[80vh] flex flex-col",children:[(0,a.jsxs)(y.DialogHeader,{children:[(0,a.jsx)(y.DialogTitle,{children:eD.type}),(0,a.jsxs)(y.DialogDescription,{children:["Status: ",eD.status," ",eD.created_at&&"- Created: ".concat(new Date(eD.created_at).toLocaleDateString())]})]}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto py-4",children:(0,a.jsxs)(_.Tabs,{defaultValue:"participants",className:"w-full",children:[(0,a.jsxs)(_.TabsList,{className:"grid w-full grid-cols-3",children:[(0,a.jsxs)(_.TabsTrigger,{value:"participants",className:"flex items-center",children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Participants"]}),(0,a.jsxs)(_.TabsTrigger,{value:"games",className:"flex items-center",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Games"]}),(0,a.jsxs)(_.TabsTrigger,{value:"settings",className:"flex items-center",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),(0,a.jsx)(_.TabsContent,{value:"participants",className:"pt-4",children:(0,a.jsx)(eG,{tournamentId:eD.id})}),(0,a.jsx)(_.TabsContent,{value:"games",className:"pt-4",children:(0,a.jsx)(eV,{tournamentId:eD.id})}),(0,a.jsx)(_.TabsContent,{value:"settings",className:"pt-4",children:(0,a.jsxs)("div",{className:"space-y-6 p-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eL.Label,{className:"text-sm font-medium",children:"Tournament Type"}),(0,a.jsxs)(el.Select,{value:eD.type,disabled:!0,children:[(0,a.jsx)(el.SelectTrigger,{className:"w-full mt-1",children:(0,a.jsx)(el.SelectValue,{})}),(0,a.jsx)(el.SelectContent,{children:eb.map(e=>(0,a.jsx)(el.SelectItem,{value:e,children:e},e))})]})]}),(0,a.jsx)(er.Separator,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eL.Label,{className:"text-sm font-medium mb-2 block",children:"Tournament Status"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(I.Badge,{className:eP(eD.status),children:eD.status.charAt(0).toUpperCase()+eD.status.slice(1)}),"await"===eD.status&&(0,a.jsxs)(T.Button,{size:"sm",variant:"outline",onClick:sv,disabled:eZ,className:"flex items-center",children:[eZ?(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4 mr-2"}):null,"Start Tournament"]})]})]}),(0,a.jsx)(er.Separator,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eL.Label,{className:"text-sm font-medium mb-3 block",children:"AI Players"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)(T.Button,{onClick:sb,disabled:eY,size:"sm",className:"flex items-center",children:[eY?(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4 mr-2"}):(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Add AI Players"]}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Adds 4 AI players to the tournament"})]})]})]})})]})}),(0,a.jsx)(y.DialogFooter,{children:(0,a.jsx)(y.DialogClose,{asChild:!0,children:(0,a.jsx)(T.Button,{type:"button",variant:"outline",children:"Close"})})})]})}),(0,a.jsx)(y.Dialog,{open:eO,onOpenChange:eR,children:(0,a.jsxs)(y.DialogContent,{className:"max-w-[300px]",children:[(0,a.jsxs)(y.DialogHeader,{children:[(0,a.jsx)(y.DialogTitle,{children:"Create New Tournament"}),(0,a.jsx)(y.DialogDescription,{children:"Set up a new tournament with your preferred settings."})]}),(0,a.jsx)("div",{className:"py-4",children:(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(eL.Label,{htmlFor:"tournament-type",className:"text-sm font-medium",children:"Tournament Type"}),(0,a.jsxs)(el.Select,{value:ez,onValueChange:eW,children:[(0,a.jsx)(el.SelectTrigger,{className:"w-full mt-1",children:(0,a.jsx)(el.SelectValue,{placeholder:"Select tournament type"})}),(0,a.jsx)(el.SelectContent,{children:eb.map(e=>(0,a.jsx)(el.SelectItem,{value:e,children:e},e))})]}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:ev[ez]})]})})}),(0,a.jsxs)(y.DialogFooter,{children:[(0,a.jsx)(y.DialogClose,{asChild:!0,children:(0,a.jsx)(T.Button,{type:"button",variant:"outline",children:"Cancel"})}),(0,a.jsxs)(T.Button,{onClick:sj,disabled:eK,className:"flex items-center",children:[eK?(0,a.jsx)(l.A,{className:"animate-spin h-4 w-4 mr-2"}):(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Create Tournament"]})]})]})}),(0,a.jsx)(eq,{isOpen:eC,onClose:()=>eS(!1),user:M,theme:U,setTheme:B,isLoadingSession:sc,selectedBoardStyle:sl,saveBoardStyleSetting:R,isSavingBoardStyle:sn}),(0,a.jsxs)("div",{className:(0,eN.cn)("p-2 fixed -bottom-3 left-0 right-0 z-30 bg-transparent transition-transform duration-300 ease-in-out",e0?"translate-y-full":"translate-y-0"),children:[(0,a.jsxs)("div",{className:"absolute -top-4 left-2 z-[9999] px-2 py-1 bg-black/20 backdrop-blur-sm rounded text-xs text-white/70 font-mono pointer-events-none",children:["v",b.rE]}),(0,a.jsxs)("div",{className:"w-full h-16 bg-purple-900/90 backdrop-blur-md rounded-lg flex items-center justify-between shadow-lg px-1",children:[(0,a.jsxs)("div",{className:"flex-1 flex justify-end items-center",children:[(0,a.jsxs)(T.Button,{variant:"ghost",className:"text-white flex flex-col items-center justify-center h-full px-2",onClick:()=>ew("profile"),children:[(0,a.jsx)(x.A,{className:"h-5 w-5 mb-0.5"}),(0,a.jsx)("span",{className:"text-xs leading-tight",children:"Profile"})]}),(0,a.jsxs)(T.Button,{variant:"ghost",className:"flex-grow-0 text-white flex flex-col items-center justify-center h-full px-2",onClick:()=>ew("tournaments"),children:[(0,a.jsx)(o.A,{className:"h-5 w-5 mb-0.5"}),(0,a.jsx)("span",{className:"text-xs leading-tight",children:"Rating"})]})]}),(0,a.jsx)("div",{className:"flex-shrink-0 bg-transparent border-none relative",onClick:()=>eS(!eC),children:(0,a.jsxs)(N.Avatar,{className:"relative z-50 transition-all duration-300 size-16 md:size-20 transform ".concat(eC?"scale-125 -translate-y-5 border-4 border-purple-400":"scale-100 -translate-y-3 border-2 border-purple-700"," shadow-lg"),children:[!!(null==M?void 0:M.image)&&(0,a.jsx)(N.AvatarImage,{src:M.image}),(0,a.jsx)(N.AvatarFallback,{className:"text-lg",children:(null==M?void 0:M.name)?M.name.charAt(0).toUpperCase():"?"}),sc&&(0,a.jsx)(l.A,{className:"animate-spin absolute top-0 left-0 w-full h-full text-white"})]})}),(0,a.jsxs)("div",{className:"flex-1 flex justify-start items-center space-x-1",children:[(0,a.jsxs)(T.Button,{variant:"ghost",className:"text-white flex flex-col items-center justify-center h-full px-2",onClick:()=>ew("skins"),children:[(0,a.jsx)(h.A,{className:"h-5 w-5 mb-0.5"}),(0,a.jsx)("span",{className:"text-xs leading-tight",children:"Skins"})]}),(0,a.jsxs)(T.Button,{variant:"ghost",className:"text-white flex flex-col items-center justify-center h-full px-2",onClick:()=>ew("games"),children:[(0,a.jsx)(p.A,{className:"h-5 w-5 mb-0.5"}),(0,a.jsx)("span",{className:"text-xs leading-tight",children:"Games"})]})]})]})]})]}),(0,a.jsx)("div",{className:(0,eN.cn)("fixed inset-0 z-60 bg-background/95 backdrop-blur-sm flex flex-col items-center justify-center transition-transform duration-500 ease-in-out",e0?"translate-y-0":"translate-y-full"),children:e0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.Button,{variant:"outline",size:"icon",className:"absolute top-4 right-4 z-50 rounded-full",onClick:su,children:(0,a.jsx)(g.A,{})}),(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center p-4",children:(0,a.jsx)(K,{gameId:e0,onClose:su,gameInvite:e9,onJoinInvite:sm})})]})}),(0,a.jsx)(eA,{children:(0,a.jsx)(eT,{isOpen:e5||!(null==ec?void 0:ec.length),onClose:()=>e3(!1)})}),(z.needsUserInteraction&&"granted"!==z.permissionStatus||q.needsUserInteraction&&"granted"!==q.permissionStatus)&&(0,a.jsx)(y.Dialog,{open:!0,children:(0,a.jsxs)(y.DialogContent,{className:"z-[9999]",style:{zIndex:9999},children:[(0,a.jsx)(y.DialogHeader,{children:(0,a.jsx)(y.DialogTitle,{children:"Allow Device Access"})}),(0,a.jsx)("button",{onClick:async()=>{z.needsUserInteraction&&"granted"!==z.permissionStatus&&await z.requestPermission(),q.needsUserInteraction&&"granted"!==q.permissionStatus&&await q.requestPermission()},className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded-full transition-colors",children:"\uD83D\uDCF1 Allow Device Access"})]})}),(0,a.jsx)(eI,{isOpen:e6,onClose:()=>e8(!1)}),(0,a.jsx)("div",{className:(0,eN.cn)("fixed inset-0 z-60 bg-background/95 backdrop-blur-sm flex flex-col items-center justify-center transition-transform duration-500 ease-in-out",st?"translate-y-0":"-translate-y-full"),children:st&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.Button,{variant:"outline",size:"icon",className:"absolute top-4 right-4 z-50 rounded-full",onClick:()=>sa(!1),children:(0,a.jsx)(g.A,{})}),(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)(ek,{})})]})})]}):(0,a.jsx)("div",{className:"flex flex-1 flex-col bg-background items-center justify-center h-screen p-4",children:(0,a.jsx)(ea.OAuthButtons,{})})}},26366:()=>{},91691:(e,s,t)=>{Promise.resolve().then(t.bind(t,15038))}},e=>{var s=s=>e(e.s=s);e.O(0,[23,8603,8568,1841,8747,5870,1989,5592,2178,194,9072,5913,6671,348,210,6113,5728,2464,4792,8441,1684,7358],()=>s(91691)),_N_E=e.O()}]);