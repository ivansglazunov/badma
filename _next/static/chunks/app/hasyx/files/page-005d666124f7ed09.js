(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3404],{53615:(e,t,s)=>{Promise.resolve().then(s.bind(s,82651))},82651:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var r=s(95155),d=s(12115),a=s(59918),i=s(80239),l=s(2693),n=s(259),o=s(56671),c=s(14286),m=s(51825),x=s(24646),u=s(9049),h=s(25092);function p(){let e=(0,n.useTranslations)("nav"),t=(0,n.useTranslations)("pages.files"),s=(0,n.useTranslations)("files"),p=(0,n.useTranslations)("actions"),f=(0,n.useTranslations)("common"),[g,b]=(0,d.useState)("grid"),{handleFilesSelected:j,handleUploadComplete:v,handleUploadError:y}=(0,c.useFilesUpload)(),{choose:N,setChoose:w,toggleChoose:D,clearChoose:k,isChosen:C}=(0,u.r)(),T=(0,n.useHasyx)(),U=(0,c.useFilesStore)(),{data:F=[],loading:E,error:B}=(0,n.useSubscription)({table:"files",where:{},returning:["id","name","size","mimeType","createdAt","updatedAt","isUploaded","uploadedByUserId"],order_by:[{createdAt:"desc"}]}),S=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},z=e=>e.startsWith("image/")?"\uD83D\uDDBC️":e.startsWith("video/")?"\uD83C\uDFA5":e.startsWith("audio/")?"\uD83C\uDFB5":e.includes("pdf")?"\uD83D\uDCC4":e.includes("text/")?"\uD83D\uDCDD":e.includes("application/")?"\uD83D\uDCE6":"\uD83D\uDCC1",A=(e,t)=>t.startsWith("image/")?"/api/files/".concat(e):null,M=e=>new Date(e).toLocaleDateString(),_=async e=>{if(confirm(s("confirm.deleteOne")))try{if((await fetch("/api/files/".concat(e),{method:"DELETE"})).ok)o.oR.success(s("toast.deleteSuccessOne"));else throw Error(s("toast.deleteFailed"))}catch(e){console.error("Delete error:",e),o.oR.error(s("toast.deleteFailed"))}},L=async()=>{if(N&&0!==N.length&&confirm(s("confirm.deleteMany",{count:N.length})))try{await T.delete({table:"deleteFiles",where:{id:{_in:N}}}),o.oR.success(s("toast.deleteSuccessMany",{count:N.length})),k()}catch(e){console.error("Delete selected files error:",e),o.oR.error(s("toast.deleteFailedMany"))}};return B&&!F.length?(0,r.jsx)(l.SidebarLayout,{sidebarData:a.A,breadcrumb:[{title:i.UU,link:"/"},{title:e("files"),link:"/hasyx/files"}],children:(0,r.jsx)("div",{className:"flex flex-1 flex-col gap-4 p-4",children:(0,r.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:(0,r.jsx)("div",{className:"text-destructive",children:s("toast.errorLoading",{message:B.message})})})})}):(0,r.jsx)(l.SidebarLayout,{sidebarData:a.A,breadcrumb:[{title:i.UU,link:"/"},{title:e("files"),link:"/hasyx/files"}],children:(0,r.jsxs)("div",{className:"flex flex-1 flex-col gap-4 p-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:t("title")}),(0,r.jsx)("p",{className:"text-muted-foreground",children:t("description")})]}),(0,r.jsxs)(c.Files,{onFilesSelected:j,onUploadComplete:v,onUploadError:y,multiple:!0,className:"mb-6 bg-card p-8 rounded-xl shadow-sm border-2 border-dashed border-border hover:border-primary transition-colors cursor-pointer",dragActiveClassName:"border-primary bg-primary/10",children:[(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"text-6xl",children:"\uD83D\uDCC1"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold",children:s("example.dropHere")}),(0,r.jsx)("p",{className:"text-muted-foreground",children:s("example.orClick")})]}),(0,r.jsx)(m.Button,{className:"bg-primary hover:bg-primary/90 text-primary-foreground px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2 mx-auto",children:(0,r.jsx)("span",{children:s("example.uploadFiles")})})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(c.FilesZone,{onRemove:e=>U.removeFile(e),renderRemoveButton:e=>(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),U.removeFile(e)},className:"text-muted-foreground hover:text-destructive transition-colors p-1",title:s("removeFile"),type:"button",children:"✕"})})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground bg-muted px-4 py-2 rounded-lg",children:E?(0,r.jsx)("div",{className:"flex items-center space-x-2",children:(0,r.jsx)(x.Status,{status:"connecting",label:f("loading")})}):s("items",{count:F.length})}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[N?(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(m.Button,{variant:"destructive",size:"sm",onClick:L,children:p("delete")}),(0,r.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{w(F.map(e=>e.id))},children:f("yes")}),(0,r.jsx)("span",{className:"text-sm font-medium text-primary",children:s("selected",{count:N.length})}),(0,r.jsx)(m.Button,{variant:"outline",size:"sm",onClick:k,children:p("cancel")})]}):(0,r.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>w([]),children:p("select")||"Choose"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 bg-muted rounded-lg p-1",children:[(0,r.jsxs)("button",{onClick:()=>b("grid"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("grid"===g?"bg-background text-primary shadow-sm":"text-muted-foreground hover:text-foreground"),children:["\uD83D\uDDBC️ ",s("view.grid")]}),(0,r.jsxs)("button",{onClick:()=>b("list"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("list"===g?"bg-background text-primary shadow-sm":"text-muted-foreground hover:text-foreground"),children:["\uD83D\uDCCB ",s("view.list")]}),(0,r.jsxs)("button",{onClick:()=>b("table"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("table"===g?"bg-background text-primary shadow-sm":"text-muted-foreground hover:text-foreground"),children:["\uD83D\uDCCA ",s("view.table")]})]})]})]}),E&&(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)(x.Status,{status:"connecting",label:s("loadingFiles")})}),!E&&"grid"===g&&(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:F.map(e=>(0,r.jsxs)("div",{className:"bg-card rounded-xl shadow-sm border border-border p-6 hover:shadow-md transition-shadow duration-200 relative",children:[N&&(0,r.jsx)("div",{className:"absolute top-2 left-2 z-10",children:(0,r.jsx)(h.Checkbox,{checked:C(e.id),onCheckedChange:()=>D(e.id)})}),(0,r.jsxs)("div",{className:"text-center",children:[e.mimeType.startsWith("image/")?(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("img",{src:A(e.id,e.mimeType),alt:e.name,className:"w-full h-32 object-cover rounded-lg border border-border",onError:e=>{let t=e.target;t.style.display="none",t.nextElementSibling.classList.remove("hidden")}}),(0,r.jsx)("div",{className:"text-5xl hidden",children:z(e.mimeType)})]}):(0,r.jsx)("div",{className:"text-5xl mb-4",children:z(e.mimeType)}),(0,r.jsx)("div",{className:"text-sm font-medium text-foreground truncate mb-2",title:e.name,children:e.name}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground mb-3",children:S(e.size)}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground/70 mb-4",children:M(e.createdAt)}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.isUploaded?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.isUploaded?s("status.uploaded"):s("status.processing")})}),(0,r.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,r.jsxs)("a",{href:"/api/files/".concat(e.id),download:e.name,className:"text-primary hover:text-primary/80 text-sm font-medium",children:["\uD83D\uDCE5 ",p("download")]}),(0,r.jsxs)("button",{onClick:()=>_(e.id),className:"text-destructive hover:text-destructive/80 text-sm font-medium",children:["\uD83D\uDDD1️ ",p("delete")]})]})]})]},e.id))}),!E&&"list"===g&&(0,r.jsx)("div",{className:"bg-card rounded-xl shadow-sm border border-border overflow-hidden",children:F.map(e=>(0,r.jsx)("div",{className:"p-6 border-b border-border/50 last:border-b-0 hover:bg-muted/50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[N&&(0,r.jsx)(h.Checkbox,{checked:C(e.id),onCheckedChange:()=>D(e.id)}),e.mimeType.startsWith("image/")?(0,r.jsxs)("div",{className:"w-12 h-12 flex-shrink-0",children:[(0,r.jsx)("img",{src:A(e.id,e.mimeType),alt:e.name,className:"w-full h-full object-cover rounded border border-border",onError:e=>{let t=e.target;t.style.display="none",t.nextElementSibling.classList.remove("hidden")}}),(0,r.jsx)("span",{className:"text-2xl hidden",children:z(e.mimeType)})]}):(0,r.jsx)("span",{className:"text-3xl",children:z(e.mimeType)}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-foreground",children:e.name}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[S(e.size)," • ",M(e.createdAt),!e.isUploaded&&" • ⏳ Processing"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.isUploaded?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.isUploaded?s("status.uploaded"):s("status.processing")}),(0,r.jsxs)("a",{href:"/api/files/".concat(e.id),download:e.name,className:"text-primary hover:text-primary/80 text-sm font-medium",children:["\uD83D\uDCE5 ",p("download")]}),(0,r.jsxs)("button",{onClick:()=>_(e.id),className:"text-destructive hover:text-destructive/80 text-sm font-medium",children:["\uD83D\uDDD1️ ",p("delete")]})]})]})},e.id))}),!E&&"table"===g&&(0,r.jsx)("div",{className:"bg-card rounded-xl shadow-sm border border-border overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-muted/50",children:(0,r.jsxs)("tr",{children:[N&&(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.select")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.file")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.size")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.type")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.created")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.status")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.actions")})]})}),(0,r.jsx)("tbody",{className:"bg-card divide-y divide-border/50",children:F.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-muted/50 transition-colors",children:[N&&(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)(h.Checkbox,{checked:C(e.id),onCheckedChange:()=>D(e.id)})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"text-2xl mr-3",children:z(e.mimeType)}),(0,r.jsx)("div",{className:"text-sm font-medium text-foreground",children:e.name})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground",children:S(e.size)}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground",children:e.mimeType}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground",children:M(e.createdAt)}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.isUploaded?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.isUploaded?"Uploaded":"Processing"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("a",{href:"/api/files/".concat(e.id),download:e.name,className:"text-primary hover:text-primary/80",children:"\uD83D\uDCE5 Download"}),(0,r.jsx)("button",{onClick:()=>_(e.id),className:"text-destructive hover:text-destructive/80",children:"\uD83D\uDDD1️ Delete"})]})})]},e.id))})]})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8603,8568,2178,194,8174,9072,2693,697,6671,3643,9918,8441,1684,7358],()=>t(53615)),_N_E=e.O()}]);