(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[295],{74463:(e,s,l)=>{"use strict";s.Messaging=function(){let e=(0,r.useHasyx)(),s=(0,x.useTranslations)("messaging"),l=(0,x.useTranslations)("actions"),[_,g]=(0,t.useState)(null),[p,j]=(0,t.useState)(!1),[v,f]=(0,t.useState)({title:"",allow_select_users:[],allow_change_users:[],allow_reply_users:[],allow_remove_users:[],allow_delete_users:[]}),{data:w=[],loading:y}=(0,r.useSubscription)({table:"rooms",where:{},returning:["id","title","user_id","allow_select_users","allow_change_users","allow_reply_users","allow_remove_users","allow_delete_users","created_at","updated_at"],order_by:[{updated_at:"desc"}]}),[N,b]=(0,t.useState)(!1),C=(e,s)=>{f(l=>Object.assign(Object.assign({},l),{[e]:s}))};return(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:"w-[300px] border-r flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)(i.Dialog,{open:p,onOpenChange:j,children:[(0,a.jsx)(i.DialogTrigger,{asChild:!0,children:(0,a.jsxs)(n.Button,{className:"w-full",size:"sm",children:[(0,a.jsx)(u.Plus,{className:"w-4 h-4 mr-2"}),s("createRoom")]})}),(0,a.jsxs)(i.DialogContent,{className:"sm:max-w-[500px]",children:[(0,a.jsx)(i.DialogHeader,{children:(0,a.jsx)(i.DialogTitle,{children:s("createNewRoom")})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{htmlFor:"room-title",children:s("roomTitle")}),(0,a.jsx)(c.Input,{id:"room-title",placeholder:s("enterRoomTitle"),value:v.title,onChange:e=>C("title",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{children:s("whoCanView")}),(0,a.jsx)(m.MultiSelectHasyx,{value:v.allow_select_users,onValueChange:e=>C("allow_select_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{children:s("whoCanEdit")}),(0,a.jsx)(m.MultiSelectHasyx,{value:v.allow_change_users,onValueChange:e=>C("allow_change_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{children:s("whoCanReply")}),(0,a.jsx)(m.MultiSelectHasyx,{value:v.allow_reply_users,onValueChange:e=>C("allow_reply_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{children:s("whoCanRemoveOwn")}),(0,a.jsx)(m.MultiSelectHasyx,{value:v.allow_remove_users,onValueChange:e=>C("allow_remove_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.Label,{children:s("whoCanDeleteAny")}),(0,a.jsx)(m.MultiSelectHasyx,{value:v.allow_delete_users,onValueChange:e=>C("allow_delete_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,a.jsx)(n.Button,{variant:"outline",onClick:()=>j(!1),children:l("cancel")}),(0,a.jsx)(n.Button,{onClick:()=>{var s,l,a,t;return s=this,l=void 0,a=void 0,t=function*(){if(!v.title.trim())return void console.error("❌ Room title is required");b(!0);try{let s=yield e.insert({table:"rooms",object:{id:crypto.randomUUID(),title:v.title,allow_select_users:v.allow_select_users,allow_change_users:v.allow_change_users,allow_reply_users:v.allow_reply_users,allow_remove_users:v.allow_remove_users,allow_delete_users:v.allow_delete_users},returning:["id","title","user_id","created_at"]});console.log("✅ Room created:",s),j(!1),f({title:"",allow_select_users:[],allow_change_users:[],allow_reply_users:[],allow_remove_users:[],allow_delete_users:[]})}catch(e){console.error("❌ Error creating room:",e)}finally{b(!1)}},new(a||(a=Promise))(function(e,r){function n(e){try{c(t.next(e))}catch(e){r(e)}}function i(e){try{c(t.throw(e))}catch(e){r(e)}}function c(s){var l;s.done?e(s.value):((l=s.value)instanceof a?l:new a(function(e){e(l)})).then(n,i)}c((t=t.apply(s,l||[])).next())})},disabled:N,children:N?s("creating"):l("create")})]})]})]})}),(0,a.jsx)(d.ScrollArea,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2 space-y-1",children:y?(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:s("loadingRooms")}):0===w.length?(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:s("noRooms")}):w.map(e=>(0,a.jsxs)("div",{className:"p-3 rounded-lg cursor-pointer transition-colors ".concat((null==_?void 0:_.id)===e.id?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>g(e),children:[(0,a.jsx)("div",{className:"font-medium",children:e.title}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:new Date(e.updated_at).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})})]},e.id))})})]}),(0,a.jsx)("div",{className:"flex-1",children:_?(0,a.jsx)(h.default,{room:_}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(u.MessageSquare,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:s("selectRoomToView")})]})})})]})};let a=l(95155),t=l(12115),r=l(259),n=l(51825),i=l(98717),c=l(1035),o=l(34545),d=l(90),u=l(47937),m=l(22742),x=l(259),h=function(e){return e&&e.__esModule?e:{default:e}}(l(88333))},88333:(e,s,l)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(e){let{room:s}=e,l=(0,r.useHasyx)(),m=(0,u.useTranslations)("messaging"),[x,h]=(0,t.useState)(""),[_,g]=(0,t.useState)(!1),{data:p=[],loading:j}=(0,r.useSubscription)({table:"messages",where:{replies:{room_id:{_eq:s.id}}},returning:["id","value","user_id","created_at","updated_at"],order_by:[{created_at:"asc"}]}),{data:v=[]}=(0,r.useQuery)({table:"users",where:{},returning:["id","name"]}),f=e=>{let s=v.find(s=>s.id===e);return(null==s?void 0:s.name)||"User ".concat(e)},w=()=>{var e,a,t,r;return e=this,a=void 0,t=void 0,r=function*(){if(x.trim()){g(!0);try{let e=crypto.randomUUID(),a=yield l.insert({table:"messages",object:{id:e,value:x.trim()},returning:["id","value","user_id"]}),t=crypto.randomUUID();yield l.insert({table:"replies",object:{id:t,message_id:e,room_id:s.id},returning:["id"]}),console.log("✅ Message sent:",a),h("")}catch(e){console.error("❌ Error sending message:",e)}finally{g(!1)}}},new(t||(t=Promise))(function(s,l){function n(e){try{c(r.next(e))}catch(e){l(e)}}function i(e){try{c(r.throw(e))}catch(e){l(e)}}function c(e){var l;e.done?s(e.value):((l=e.value)instanceof t?l:new t(function(e){e(l)})).then(n,i)}c((r=r.apply(e,a||[])).next())})};return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:s.title}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:m("createdAt",{date:new Date(s.created_at).toLocaleDateString()})})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)(n.Badge,{variant:"secondary",children:[(0,a.jsx)(d.MessageSquare,{className:"w-3 h-3 mr-1"}),m("messagesCount",{count:p.length})]})})]})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsx)(i.ScrollArea,{className:"flex-1 p-4",children:j?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:m("loadingMessages")}):0===p.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(d.MessageSquare,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:m("noMessages")}),(0,a.jsx)("p",{className:"text-sm",children:m("startConversation")})]}):(0,a.jsx)("div",{className:"space-y-4",children:p.map(e=>(0,a.jsx)("div",{className:"flex flex-col space-y-1",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:f(e.user_id).charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:f(e.user_id)}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleTimeString()})]}),(0,a.jsx)("div",{className:"mt-1 p-3 bg-muted rounded-lg",children:e.value})]})]})},e.id))})}),(0,a.jsx)("div",{className:"p-4 border-t bg-background",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(o.Textarea,{placeholder:m("enterMessage"),value:x,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())},className:"flex-1 min-h-[60px] max-h-[120px] resize-none",disabled:_}),(0,a.jsx)(c.Button,{onClick:w,disabled:!x.trim()||_,className:"self-end",children:(0,a.jsx)(d.Send,{className:"w-4 h-4"})})]})})]})]})};let a=l(95155),t=l(12115),r=l(259),n=l(51364),i=l(90),c=l(51825),o=l(43655),d=l(47937),u=l(259)},93189:(e,s,l)=>{Promise.resolve().then(l.bind(l,74463)),Promise.resolve().then(l.bind(l,2693))}},e=>{var s=s=>e(e.s=s);e.O(0,[8603,8568,2178,194,8174,9072,2693,4065,7451,8441,1684,7358],()=>s(93189)),_N_E=e.O()}]);