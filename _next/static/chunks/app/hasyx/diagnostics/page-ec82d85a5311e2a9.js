(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[683],{63846:(e,i,s)=>{Promise.resolve().then(s.bind(s,64472)),Promise.resolve().then(s.bind(s,48787))},64472:(e,i,s)=>{"use strict";s.d(i,{default:()=>x});var d=s(95155),r=s(12115),t=s(259),a=s(51825),n=s(1035),l=s(53959),c=s(92648),o=s(56671);function x(){(0,t.useTranslations)("diagnostics.invites");let e=(0,t.useHasyx)(),[i,s]=(0,r.useState)(!1),[x,h]=(0,r.useState)(""),[u,v]=(0,r.useState)(""),[m,j]=(0,r.useState)([]),[C,_]=(0,r.useState)([]),[p,g]=(0,r.useState)([]),[y,f]=(0,r.useState)([]),N=(0,r.useMemo)(()=>e.userId,[e.userId]);async function b(){if(N){s(!0);try{let i=await e.select({table:"invites",where:{user_id:{_eq:N}},returning:["id","code","created_at","updated_at","user_id"],role:"me"});j(Array.isArray(i)?i:i?[i]:[]);let s=await e.select({table:"invited",where:{_or:[{user_id:{_eq:N}},{invite:{user_id:{_eq:N}}}]},returning:["id","invite_id","user_id","created_at"],role:"me"});_(Array.isArray(s)?s:s?[s]:[]);try{let i=await e.select({table:"invites",where:{},returning:["id","code","created_at","updated_at","user_id"],role:e.apolloClient._options.secret?"admin":void 0});g(Array.isArray(i)?i:i?[i]:[])}catch(e){}try{let i=await e.select({table:"invited",where:{},returning:["id","invite_id","user_id","created_at"],role:e.apolloClient._options.secret?"admin":void 0});f(Array.isArray(i)?i:i?[i]:[])}catch(e){}}finally{s(!1)}}}async function w(){if(!N)return void o.oR.error("No user");s(!0);try{let i=await e.insert({table:"invites",object:{user_id:N,code:x||void 0},returning:["id","code","created_at","user_id"],role:"me"});o.oR.success("Invite created: ".concat((null==i?void 0:i.code)||"")),h(""),b()}catch(e){o.oR.error((null==e?void 0:e.message)||"Failed to create invite")}finally{s(!1)}}async function I(){s(!0);try{let i=await e.invite(u.trim());(null==i?void 0:i.success)?(o.oR.success("Invite redeemed"),v(""),b()):o.oR.error((null==i?void 0:i.message)||"Failed to redeem invite")}catch(e){o.oR.error((null==e?void 0:e.message)||"Failed to redeem invite")}finally{s(!1)}}async function T(i){s(!0);try{await e.delete({table:"invites",pk_columns:{id:i},returning:["id"],role:"me"}),o.oR.success("Invite deleted"),b()}catch(e){o.oR.error((null==e?void 0:e.message)||"Failed to delete invite")}finally{s(!1)}}return(0,r.useEffect)(()=>{b()},[N]),(0,d.jsx)("div",{className:"p-4",children:(0,d.jsxs)(l.Card,{className:"mb-4",children:[(0,d.jsxs)(l.CardHeader,{children:[(0,d.jsx)(l.CardTitle,{children:"Invites diagnostics"}),(0,d.jsx)(l.CardDescription,{children:"Create, redeem, and inspect invites"})]}),(0,d.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,d.jsx)(n.Input,{placeholder:"Custom code (optional)",value:x,onChange:e=>h(e.target.value)}),(0,d.jsx)(a.Button,{disabled:i,onClick:w,children:"Create Invite"})]}),(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,d.jsx)(n.Input,{placeholder:"Invite code",value:u,onChange:e=>v(e.target.value)}),(0,d.jsx)(a.Button,{disabled:i||!u.trim(),onClick:I,children:"Redeem Invite"})]}),(0,d.jsx)(c.Separator,{}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)(l.Card,{children:[(0,d.jsxs)(l.CardHeader,{children:[(0,d.jsx)(l.CardTitle,{children:"My invites"}),(0,d.jsxs)(l.CardDescription,{children:["Total: ",m.length]})]}),(0,d.jsx)(l.CardContent,{children:(0,d.jsxs)("div",{className:"space-y-2",children:[m.map(e=>(0,d.jsxs)("div",{className:"flex items-center justify-between border rounded-md p-2",children:[(0,d.jsxs)("div",{className:"text-sm",children:[(0,d.jsxs)("div",{children:["Code: ",(0,d.jsx)("b",{children:e.code})]}),(0,d.jsxs)("div",{className:"text-muted-foreground",children:["id: ",e.id]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(a.Button,{size:"sm",variant:"outline",onClick:()=>navigator.clipboard.writeText(e.code),children:"Copy"}),(0,d.jsx)(a.Button,{size:"sm",variant:"destructive",onClick:()=>T(e.id),children:"Delete"})]})]},e.id)),0===m.length&&(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"No invites"})]})})]}),(0,d.jsxs)(l.Card,{children:[(0,d.jsxs)(l.CardHeader,{children:[(0,d.jsx)(l.CardTitle,{children:"My invited relations"}),(0,d.jsxs)(l.CardDescription,{children:["Total: ",C.length]})]}),(0,d.jsx)(l.CardContent,{children:(0,d.jsxs)("div",{className:"space-y-2",children:[C.map(e=>(0,d.jsxs)("div",{className:"border rounded-md p-2 text-sm",children:[(0,d.jsxs)("div",{children:["id: ",e.id]}),(0,d.jsxs)("div",{children:["invite_id: ",e.invite_id]}),(0,d.jsxs)("div",{children:["user_id: ",e.user_id]}),(0,d.jsxs)("div",{children:["created_at: ",e.created_at]})]},e.id)),0===C.length&&(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"No invited records"})]})})]})]}),(0,d.jsx)(c.Separator,{}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)(l.Card,{children:[(0,d.jsxs)(l.CardHeader,{children:[(0,d.jsx)(l.CardTitle,{children:"All invites (admin)"}),(0,d.jsxs)(l.CardDescription,{children:["Total: ",p.length]})]}),(0,d.jsx)(l.CardContent,{children:(0,d.jsxs)("div",{className:"space-y-2",children:[p.map(e=>(0,d.jsxs)("div",{className:"border rounded-md p-2 text-sm",children:[(0,d.jsxs)("div",{children:["code: ",(0,d.jsx)("b",{children:e.code})]}),(0,d.jsxs)("div",{children:["id: ",e.id]}),(0,d.jsxs)("div",{children:["user_id: ",e.user_id]})]},e.id)),0===p.length&&(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"—"})]})})]}),(0,d.jsxs)(l.Card,{children:[(0,d.jsxs)(l.CardHeader,{children:[(0,d.jsx)(l.CardTitle,{children:"All invited (admin)"}),(0,d.jsxs)(l.CardDescription,{children:["Total: ",y.length]})]}),(0,d.jsx)(l.CardContent,{children:(0,d.jsxs)("div",{className:"space-y-2",children:[y.map(e=>(0,d.jsxs)("div",{className:"border rounded-md p-2 text-sm",children:[(0,d.jsxs)("div",{children:["id: ",e.id]}),(0,d.jsxs)("div",{children:["invite_id: ",e.invite_id]}),(0,d.jsxs)("div",{children:["user_id: ",e.user_id]}),(0,d.jsxs)("div",{children:["created_at: ",e.created_at]})]},e.id)),0===y.length&&(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"—"})]})})]})]})]})]})})}}},e=>{var i=i=>e(e.s=i);e.O(0,[8603,8568,2178,194,8174,9072,2693,6671,8787,8441,1684,7358],()=>i(63846)),_N_E=e.O()}]);