(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1189],{25848:(e,i,s)=>{"use strict";s.r(i),s.d(i,{default:()=>x});var t=s(95155),l=s(12115),r=s(59918),a=s(80239),n=s(2693),o=s(259),u=s(90),d=s(51825),c=s(98717),h=s(1035),p=s(34545),_=s(22742),m=s(84616),v=s(70218),g=s(51368);function x(){var e;let i=(0,o.useHasyx)(),s=l.useMemo(()=>new v.Groups(i),[i]),[x,y]=(0,l.useState)(null),[w,b]=(0,l.useState)(!1),[j,f]=(0,l.useState)(!1),[N,q]=(0,l.useState)(null),[C,S]=(0,l.useState)({title:"",visibility:"public",join_policy:"by_request",allow_view_users:[],allow_invite_users:[],allow_manage_members_users:[],allow_update_group_users:[],allow_delete_group_users:[],allow_request_users:[],allow_join_users:[]}),{data:k,loading:G,error:M,refetch:U}=(0,o.useQuery)({table:"groups",returning:["id","title","owner_id","visibility","join_policy","updated_at",{memberships:["id","user_id","role","status"]}],limit:100,order_by:{updated_at:"desc"}}),D=(0,l.useMemo)(()=>k||[],[k]),L=(0,l.useMemo)(()=>D.find(e=>e.id===x)||D[0],[D,x]),V=(e,i)=>{S(s=>({...s,[e]:i}))},H=async()=>{if(C.title.trim()){f(!0);try{q(null);let e=(0,g.A)();await s.createGroup({id:e,title:C.title,visibility:C.visibility,join_policy:C.join_policy});let i={allow_view_users:C.allow_view_users,allow_invite_users:C.allow_invite_users,allow_manage_members_users:C.allow_manage_members_users,allow_update_group_users:C.allow_update_group_users,allow_delete_group_users:C.allow_delete_group_users,allow_request_users:C.allow_request_users,allow_join_users:C.allow_join_users};(i.allow_view_users.length||i.allow_invite_users.length||i.allow_manage_members_users.length||i.allow_update_group_users.length||i.allow_delete_group_users.length||i.allow_request_users.length||i.allow_join_users.length)&&await s.updateGroup(e,i),b(!1),S({title:"",visibility:"public",join_policy:"by_request",allow_view_users:[],allow_invite_users:[],allow_manage_members_users:[],allow_update_group_users:[],allow_delete_group_users:[],allow_request_users:[],allow_join_users:[]}),await U()}finally{f(!1)}}};return(0,t.jsx)(n.SidebarLayout,{sidebarData:r.A,breadcrumb:[{title:a.UU,link:"/"}],children:(0,t.jsxs)("div",{className:"flex h-full",children:[(0,t.jsxs)("div",{className:"w-[300px] border-r flex flex-col",children:[(0,t.jsx)("div",{className:"p-4 border-b",children:(0,t.jsxs)(c.Dialog,{open:w,onOpenChange:b,children:[(0,t.jsx)(c.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(d.Button,{className:"w-full",size:"sm",children:[(0,t.jsx)(m.A,{className:"w-4 h-4 mr-2"}),"Create Group"]})}),(0,t.jsxs)(c.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsx)(c.DialogHeader,{children:(0,t.jsx)(c.DialogTitle,{children:"Create New Group"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{htmlFor:"group-title",children:"Title"}),(0,t.jsx)(h.Input,{id:"group-title",placeholder:"Enter group title",value:C.title,onChange:e=>V("title",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{children:"Visibility"}),(0,t.jsxs)("select",{className:"border px-3 py-2 rounded w-full",value:C.visibility,onChange:e=>V("visibility",e.target.value),children:[(0,t.jsx)("option",{value:"public",children:"public"}),(0,t.jsx)("option",{value:"private",children:"private"}),(0,t.jsx)("option",{value:"secret",children:"secret"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{children:"Join policy"}),(0,t.jsxs)("select",{className:"border px-3 py-2 rounded w-full",value:C.join_policy,onChange:e=>V("join_policy",e.target.value),children:[(0,t.jsx)("option",{value:"open",children:"open"}),(0,t.jsx)("option",{value:"by_request",children:"by_request"}),(0,t.jsx)("option",{value:"invite_only",children:"invite_only"}),(0,t.jsx)("option",{value:"closed",children:"closed"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{children:"Who can view"}),(0,t.jsx)(_.MultiSelectHasyx,{value:C.allow_view_users,onValueChange:e=>V("allow_view_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{children:"Who can invite"}),(0,t.jsx)(_.MultiSelectHasyx,{value:C.allow_invite_users,onValueChange:e=>V("allow_invite_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{children:"Who can manage members"}),(0,t.jsx)(_.MultiSelectHasyx,{value:C.allow_manage_members_users,onValueChange:e=>V("allow_manage_members_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{children:"Who can update group"}),(0,t.jsx)(_.MultiSelectHasyx,{value:C.allow_update_group_users,onValueChange:e=>V("allow_update_group_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{children:"Who can delete group"}),(0,t.jsx)(_.MultiSelectHasyx,{value:C.allow_delete_group_users,onValueChange:e=>V("allow_delete_group_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{children:"Who can request"}),(0,t.jsx)(_.MultiSelectHasyx,{value:C.allow_request_users,onValueChange:e=>V("allow_request_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(p.Label,{children:"Who can join immediately"}),(0,t.jsx)(_.MultiSelectHasyx,{value:C.allow_join_users,onValueChange:e=>V("allow_join_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 pt-2",children:[(0,t.jsx)(d.Button,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),(0,t.jsx)(d.Button,{onClick:H,disabled:j,children:j?"Creating…":"Create"})]}),N&&(0,t.jsx)("div",{className:"text-sm text-red-600",children:N}),!N&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Note: creating a group requires a valid signed-in user record."})]})]})]})}),(0,t.jsx)(u.ScrollArea,{className:"flex-1",children:(0,t.jsx)("div",{className:"p-2 space-y-1",children:G?(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"Loading…"}):0===D.length?(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"No groups"}):D.map(e=>(0,t.jsxs)("div",{className:"p-3 rounded-lg cursor-pointer transition-colors ".concat((null==L?void 0:L.id)===e.id?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>y(e.id),children:[(0,t.jsx)("div",{className:"font-medium",children:e.title}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.visibility," \xb7 ",e.join_policy]})]},e.id))})})]}),(0,t.jsxs)("div",{className:"flex-1 p-4 flex flex-col gap-4",children:[!L&&(0,t.jsx)("div",{className:"text-gray-500",children:"Select a group…"}),L&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-xl font-medium",children:L.title}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Owner: ",L.owner_id||"—"," \xb7 Visibility: ",L.visibility," \xb7 Join: ",L.join_policy]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(d.Button,{variant:"outline",size:"sm",onClick:async()=>{let e=prompt("New title",L.title)||L.title;await s.updateGroup(L.id,{title:e}),await U()},children:"Rename"}),(0,t.jsx)(d.Button,{variant:"outline",size:"sm",onClick:async()=>{await s.deleteGroup(L.id),y(null),await U()},children:"Delete"})]})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-auto border rounded p-3 space-y-3",children:[(0,t.jsxs)("div",{className:"font-medium",children:["Members (",(null==(e=L.memberships)?void 0:e.length)||0,")"]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:(L.memberships||[]).map(e=>(0,t.jsxs)("div",{className:"border rounded p-3 space-y-2",children:[(0,t.jsxs)("div",{className:"text-sm",children:["User: ",e.user_id]}),(0,t.jsxs)("div",{className:"text-sm",children:["Role: ",e.role," \xb7 Status: ",e.status]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(d.Button,{variant:"outline",size:"sm",onClick:async()=>{await s.changeMemberRole(L.id,e.user_id,"admin"),await U()},children:"Make admin"}),(0,t.jsx)(d.Button,{variant:"outline",size:"sm",onClick:async()=>{await s.leaveMembership(e.id),await U()},children:"Set left"})]})]},e.id))})]})]})]})]})})}},51368:(e,i,s)=>{"use strict";let t;s.d(i,{A:()=>n});let l={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},r=new Uint8Array(16),a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));let n=function(e,i,s){if(l.randomUUID&&!i&&!e)return l.randomUUID();let n=(e=e||{}).random??e.rng?.()??function(){if(!t){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");t=crypto.getRandomValues.bind(crypto)}return t(r)}();if(n.length<16)throw Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,i){if((s=s||0)<0||s+16>i.length)throw RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let e=0;e<16;++e)i[s+e]=n[e];return i}return function(e,i=0){return(a[e[i+0]]+a[e[i+1]]+a[e[i+2]]+a[e[i+3]]+"-"+a[e[i+4]]+a[e[i+5]]+"-"+a[e[i+6]]+a[e[i+7]]+"-"+a[e[i+8]]+a[e[i+9]]+"-"+a[e[i+10]]+a[e[i+11]]+a[e[i+12]]+a[e[i+13]]+a[e[i+14]]+a[e[i+15]]).toLowerCase()}(n)}},70218:function(e,i){"use strict";var s=this&&this.__awaiter||function(e,i,s,t){return new(s||(s=Promise))(function(l,r){function a(e){try{o(t.next(e))}catch(e){r(e)}}function n(e){try{o(t.throw(e))}catch(e){r(e)}}function o(e){var i;e.done?l(e.value):((i=e.value)instanceof s?i:new s(function(e){e(i)})).then(a,n)}o((t=t.apply(e,i||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0}),i.Groups=void 0;class t{constructor(e){this.hasyx=e}createGroup(e){return s(this,void 0,void 0,function*(){let i={title:e.title};return e.id&&(i.id=e.id),e.visibility&&(i.visibility=e.visibility),e.join_policy&&(i.join_policy=e.join_policy),e.slug&&(i.slug=e.slug),this.hasyx.insert({table:"groups",object:i,returning:["id","owner_id","created_by_id"]})})}updateGroup(e,i){return s(this,void 0,void 0,function*(){yield this.hasyx.update({table:"groups",where:{id:{_eq:e}},_set:i})})}deleteGroup(e){return s(this,void 0,void 0,function*(){yield this.hasyx.delete({table:"groups",pk_columns:{id:e}})})}resignOwnership(e){return s(this,void 0,void 0,function*(){yield this.updateGroup(e,{owner_id:null})})}claimOwnership(e,i){return s(this,void 0,void 0,function*(){yield this.updateGroup(e,{owner_id:i})})}requestMembership(e,i){return s(this,void 0,void 0,function*(){let s={group_id:e};return i&&(s.user_id=i),this.hasyx.insert({table:"memberships",object:s,returning:["id","status"]})})}approveMembership(e){return s(this,void 0,void 0,function*(){yield this.hasyx.update({table:"memberships",where:{id:{_eq:e}},_set:{status:"approved"}})})}denyMembership(e){return s(this,void 0,void 0,function*(){yield this.hasyx.update({table:"memberships",where:{id:{_eq:e}},_set:{status:"denied"}})})}leaveMembership(e){return s(this,void 0,void 0,function*(){yield this.hasyx.update({table:"memberships",where:{id:{_eq:e}},_set:{status:"left"}})})}addMember(e,i){return s(this,arguments,void 0,function*(e,i,s="member",t="approved"){return this.hasyx.insert({table:"memberships",object:{group_id:e,user_id:i,role:s,status:t},returning:["id"]})})}changeMemberRole(e,i,t){return s(this,void 0,void 0,function*(){return this.hasyx.update({table:"memberships",where:{group_id:{_eq:e},user_id:{_eq:i}},_set:{role:t},returning:["role"]})})}inviteUser(e,i){return s(this,void 0,void 0,function*(){return this.hasyx.insert({table:"invitations",object:{group_id:e,invitee_user_id:i},returning:["id","status"]})})}acceptInvitation(e){return s(this,void 0,void 0,function*(){yield this.hasyx.update({table:"invitations",where:{id:{_eq:e}},_set:{status:"accepted"}})})}}i.Groups=t},87047:(e,i,s)=>{Promise.resolve().then(s.bind(s,25848))}},e=>{var i=i=>e(e.s=i);e.O(0,[8603,8568,2178,194,8174,9072,2693,697,4065,7451,9918,8441,1684,7358],()=>i(87047)),_N_E=e.O()}]);